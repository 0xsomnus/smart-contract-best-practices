
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Ethereum Smart Contract Security Best Practices">
      
      
        <meta name="author" content="ConsenSys Diligence">
      
      
        <link rel="canonical" href="https://consensys.github.io/smart-contract-best-practices/recommendations/">
      
      <link rel="icon" href="../assets/images/CDili_black.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-8.1.8">
    
    
      
        <title>Secure Development Recommendations - Ethereum Smart Contract Best Practices</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.6e60f8b8.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.e6a45f82.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  


  <script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-64552723-12","auto"),ga("set","anonymizeIp",!0),ga("send","pageview"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){var e;this.value&&(e=document.location.pathname,ga("send","pageview",e+"?q="+this.value))}),"undefined"!=typeof location$&&location$.subscribe(function(e){ga("send","pageview",e.pathname)})})</script>
  <script async src="https://www.google-analytics.com/analytics.js"></script>


    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="deep-purple">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#protocol-specific-recommendations" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Ethereum Smart Contract Best Practices" class="md-header__button md-logo" aria-label="Ethereum Smart Contract Best Practices" data-md-component="logo">
      
  <img src="../assets/images/CDili.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3,6H21V8H3V6M3,11H21V13H3V11M3,16H21V18H3V16Z" /></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Ethereum Smart Contract Best Practices
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Secure Development Recommendations
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="deep-purple"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12,2A7,7 0 0,0 5,9C5,11.38 6.19,13.47 8,14.74V17A1,1 0 0,0 9,18H15A1,1 0 0,0 16,17V14.74C17.81,13.47 19,11.38 19,9A7,7 0 0,0 12,2M9,21A1,1 0 0,0 10,22H14A1,1 0 0,0 15,21V20H9V21Z" /></svg>
            </label>
          
        
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="cyan"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12,2A7,7 0 0,1 19,9C19,11.38 17.81,13.47 16,14.74V17A1,1 0 0,1 15,18H9A1,1 0 0,1 8,17V14.74C6.19,13.47 5,11.38 5,9A7,7 0 0,1 12,2M9,21V20H15V21A1,1 0 0,1 14,22H10A1,1 0 0,1 9,21M12,4A5,5 0 0,0 7,9C7,11.05 8.23,12.81 10,13.58V16H14V13.58C15.77,12.81 17,11.05 17,9A5,5 0 0,0 12,4Z" /></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z" /></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z" /></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z" /></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/ConsenSys/smart-contract-best-practices/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    Github
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Ethereum Smart Contract Best Practices" class="md-nav__button md-logo" aria-label="Ethereum Smart Contract Best Practices" data-md-component="logo">
      
  <img src="../assets/images/CDili.png" alt="logo">

    </a>
    Ethereum Smart Contract Best Practices
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/ConsenSys/smart-contract-best-practices/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    Github
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../general_philosophy/" class="md-nav__link">
        General Philosophy
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Secure Development Recommendations
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Secure Development Recommendations
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#protocol-specific-recommendations" class="md-nav__link">
    Protocol specific recommendations
  </a>
  
    <nav class="md-nav" aria-label="Protocol specific recommendations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#external-calls" class="md-nav__link">
    External Calls
  </a>
  
    <nav class="md-nav" aria-label="External Calls">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#use-caution-when-making-external-calls" class="md-nav__link">
    Use caution when making external calls
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mark-untrusted-contracts" class="md-nav__link">
    Mark untrusted contracts
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#avoid-state-changes-after-external-calls" class="md-nav__link">
    Avoid state changes after external calls
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dont-use-transfer-or-send" class="md-nav__link">
    Don't use transfer() or send().
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#handle-errors-in-external-calls" class="md-nav__link">
    Handle errors in external calls
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#favor-pull-over-push-for-external-calls" class="md-nav__link">
    Favor pull over push for external calls
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dont-delegatecall-to-untrusted-code" class="md-nav__link">
    Don't delegatecall to untrusted code
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#remember-that-ether-can-be-forcibly-sent-to-an-account" class="md-nav__link">
    Remember that Ether can be forcibly sent to an account
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#remember-that-on-chain-data-is-public" class="md-nav__link">
    Remember that on-chain data is public
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#beware-of-the-possibility-that-some-participants-may-drop-offline-and-not-return" class="md-nav__link">
    Beware of the possibility that some participants may "drop offline" and not return
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#beware-of-negation-of-the-most-negative-signed-integer" class="md-nav__link">
    Beware of negation of the most negative signed integer
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#solidity-specific-recommendations" class="md-nav__link">
    Solidity specific recommendations
  </a>
  
    <nav class="md-nav" aria-label="Solidity specific recommendations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#enforce-invariants-with-assert" class="md-nav__link">
    Enforce invariants with assert()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-assert-require-revert-properly" class="md-nav__link">
    Use assert(), require(), revert() properly
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-modifiers-only-for-checks" class="md-nav__link">
    Use modifiers only for checks
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#beware-rounding-with-integer-division" class="md-nav__link">
    Beware rounding with integer division
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#be-aware-of-the-tradeoffs-between-abstract-contracts-and-interfaces" class="md-nav__link">
    Be aware of the tradeoffs between abstract contracts and interfaces
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fallback-functions" class="md-nav__link">
    Fallback Functions
  </a>
  
    <nav class="md-nav" aria-label="Fallback Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#keep-fallback-functions-simple" class="md-nav__link">
    Keep fallback functions simple
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#check-data-length-in-fallback-functions" class="md-nav__link">
    Check data length in fallback functions
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#explicitly-mark-payable-functions-and-state-variables" class="md-nav__link">
    Explicitly mark payable functions and state variables
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#explicitly-mark-visibility-in-functions-and-state-variables" class="md-nav__link">
    Explicitly mark visibility in functions and state variables
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lock-pragmas-to-specific-compiler-version" class="md-nav__link">
    Lock pragmas to specific compiler version
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-events-to-monitor-contract-activity" class="md-nav__link">
    Use events to monitor contract activity
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#be-aware-that-built-ins-can-be-shadowed" class="md-nav__link">
    Be aware that 'Built-ins' can be shadowed
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#avoid-using-txorigin" class="md-nav__link">
    Avoid using tx.origin
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#timestamp-dependence" class="md-nav__link">
    Timestamp Dependence
  </a>
  
    <nav class="md-nav" aria-label="Timestamp Dependence">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#timestamp-manipulation" class="md-nav__link">
    Timestamp Manipulation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-15-second-rule" class="md-nav__link">
    The 15-second Rule
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#avoid-using-blocknumber-as-a-timestamp" class="md-nav__link">
    Avoid using block.number as a timestamp
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#multiple-inheritance-caution" class="md-nav__link">
    Multiple Inheritance Caution
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-interface-type-instead-of-the-address-for-type-safety" class="md-nav__link">
    Use interface type instead of the address for type safety
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#avoid-using-extcodesize-to-check-for-externally-owned-accounts" class="md-nav__link">
    Avoid using extcodesize to check for Externally Owned Accounts
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deprecatedhistorical-recommendations" class="md-nav__link">
    Deprecated/historical recommendations
  </a>
  
    <nav class="md-nav" aria-label="Deprecated/historical recommendations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#beware-division-by-zero-solidity-04" class="md-nav__link">
    Beware division by zero (Solidity \&lt; 0.4)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#differentiate-functions-and-events-solidity-0421" class="md-nav__link">
    Differentiate functions and events (Solidity \&lt; 0.4.21)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../known_attacks/" class="md-nav__link">
        Known Attacks
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../software_engineering/" class="md-nav__link">
        Software Engineering Techniques
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../tokens/" class="md-nav__link">
        Token specific recommendations
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../documentation_procedures/" class="md-nav__link">
        Documentation and Procedures
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../security_tools/" class="md-nav__link">
        Security Tools
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../bug_bounty_list/" class="md-nav__link">
        Bug Bounty Programs
      </a>
    </li>
  

    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_10" type="checkbox" id="__nav_10" >
      
      
      
      
        <label class="md-nav__link" for="__nav_10">
          About
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="About" data-md-level="1">
        <label class="md-nav__title" for="__nav_10">
          <span class="md-nav__icon md-icon"></span>
          About
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../about/reviewers/" class="md-nav__link">
        Reviewers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../about/license/" class="md-nav__link">
        License
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../about/contributing/" class="md-nav__link">
        Contributing
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#protocol-specific-recommendations" class="md-nav__link">
    Protocol specific recommendations
  </a>
  
    <nav class="md-nav" aria-label="Protocol specific recommendations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#external-calls" class="md-nav__link">
    External Calls
  </a>
  
    <nav class="md-nav" aria-label="External Calls">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#use-caution-when-making-external-calls" class="md-nav__link">
    Use caution when making external calls
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mark-untrusted-contracts" class="md-nav__link">
    Mark untrusted contracts
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#avoid-state-changes-after-external-calls" class="md-nav__link">
    Avoid state changes after external calls
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dont-use-transfer-or-send" class="md-nav__link">
    Don't use transfer() or send().
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#handle-errors-in-external-calls" class="md-nav__link">
    Handle errors in external calls
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#favor-pull-over-push-for-external-calls" class="md-nav__link">
    Favor pull over push for external calls
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dont-delegatecall-to-untrusted-code" class="md-nav__link">
    Don't delegatecall to untrusted code
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#remember-that-ether-can-be-forcibly-sent-to-an-account" class="md-nav__link">
    Remember that Ether can be forcibly sent to an account
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#remember-that-on-chain-data-is-public" class="md-nav__link">
    Remember that on-chain data is public
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#beware-of-the-possibility-that-some-participants-may-drop-offline-and-not-return" class="md-nav__link">
    Beware of the possibility that some participants may "drop offline" and not return
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#beware-of-negation-of-the-most-negative-signed-integer" class="md-nav__link">
    Beware of negation of the most negative signed integer
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#solidity-specific-recommendations" class="md-nav__link">
    Solidity specific recommendations
  </a>
  
    <nav class="md-nav" aria-label="Solidity specific recommendations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#enforce-invariants-with-assert" class="md-nav__link">
    Enforce invariants with assert()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-assert-require-revert-properly" class="md-nav__link">
    Use assert(), require(), revert() properly
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-modifiers-only-for-checks" class="md-nav__link">
    Use modifiers only for checks
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#beware-rounding-with-integer-division" class="md-nav__link">
    Beware rounding with integer division
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#be-aware-of-the-tradeoffs-between-abstract-contracts-and-interfaces" class="md-nav__link">
    Be aware of the tradeoffs between abstract contracts and interfaces
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fallback-functions" class="md-nav__link">
    Fallback Functions
  </a>
  
    <nav class="md-nav" aria-label="Fallback Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#keep-fallback-functions-simple" class="md-nav__link">
    Keep fallback functions simple
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#check-data-length-in-fallback-functions" class="md-nav__link">
    Check data length in fallback functions
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#explicitly-mark-payable-functions-and-state-variables" class="md-nav__link">
    Explicitly mark payable functions and state variables
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#explicitly-mark-visibility-in-functions-and-state-variables" class="md-nav__link">
    Explicitly mark visibility in functions and state variables
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lock-pragmas-to-specific-compiler-version" class="md-nav__link">
    Lock pragmas to specific compiler version
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-events-to-monitor-contract-activity" class="md-nav__link">
    Use events to monitor contract activity
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#be-aware-that-built-ins-can-be-shadowed" class="md-nav__link">
    Be aware that 'Built-ins' can be shadowed
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#avoid-using-txorigin" class="md-nav__link">
    Avoid using tx.origin
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#timestamp-dependence" class="md-nav__link">
    Timestamp Dependence
  </a>
  
    <nav class="md-nav" aria-label="Timestamp Dependence">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#timestamp-manipulation" class="md-nav__link">
    Timestamp Manipulation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-15-second-rule" class="md-nav__link">
    The 15-second Rule
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#avoid-using-blocknumber-as-a-timestamp" class="md-nav__link">
    Avoid using block.number as a timestamp
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#multiple-inheritance-caution" class="md-nav__link">
    Multiple Inheritance Caution
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-interface-type-instead-of-the-address-for-type-safety" class="md-nav__link">
    Use interface type instead of the address for type safety
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#avoid-using-extcodesize-to-check-for-externally-owned-accounts" class="md-nav__link">
    Avoid using extcodesize to check for Externally Owned Accounts
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deprecatedhistorical-recommendations" class="md-nav__link">
    Deprecated/historical recommendations
  </a>
  
    <nav class="md-nav" aria-label="Deprecated/historical recommendations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#beware-division-by-zero-solidity-04" class="md-nav__link">
    Beware division by zero (Solidity \&lt; 0.4)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#differentiate-functions-and-events-solidity-0421" class="md-nav__link">
    Differentiate functions and events (Solidity \&lt; 0.4.21)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
<a href="https://github.com/ConsenSys/smart-contract-best-practices/edit/master/docs/recommendations.md" title="Edit this page" class="md-content__button md-icon">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71,7.04C21.1,6.65 21.1,6 20.71,5.63L18.37,3.29C18,2.9 17.35,2.9 16.96,3.29L15.12,5.12L18.87,8.87M3,17.25V21H6.75L17.81,9.93L14.06,6.18L3,17.25Z" /></svg>
</a>


  <h1>Secure Development Recommendations</h1>

<p>This page demonstrates a number of patterns which should generally be followed when writing smart
contracts.</p>
<h2 id="protocol-specific-recommendations">Protocol specific recommendations<a class="headerlink" href="#protocol-specific-recommendations" title="Permanent link">&para;</a></h2>
<p>The following recommendations apply to the development of any contract system on Ethereum.</p>
<h3 id="external-calls">External Calls<a class="headerlink" href="#external-calls" title="Permanent link">&para;</a></h3>
<h4 id="use-caution-when-making-external-calls">Use caution when making external calls<a class="headerlink" href="#use-caution-when-making-external-calls" title="Permanent link">&para;</a></h4>
<p>Calls to untrusted contracts can introduce several unexpected risks or errors. External calls may
execute malicious code in that contract <em>or</em> any other contract that it depends upon. As such,
every external call should be treated as a potential security risk. When it is not possible, or
undesirable to remove external calls, use the recommendations in the rest of this section to
minimize the danger.</p>
<hr />
<h4 id="mark-untrusted-contracts">Mark untrusted contracts<a class="headerlink" href="#mark-untrusted-contracts" title="Permanent link">&para;</a></h4>
<p>When interacting with external contracts, name your variables, methods, and contract interfaces in
a way that makes it clear that interacting with them is potentially unsafe. This applies to your
own functions that call external contracts.</p>
<div class="highlight"><pre><span></span><code><span class="c1">// bad</span>
<span class="n">Bank</span><span class="p">.</span><span class="n">withdraw</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span> <span class="c1">// Unclear whether trusted or untrusted</span>

<span class="kd">function</span> <span class="n">makeWithdrawal</span><span class="p">(</span><span class="kt">uint</span> <span class="n">amount</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// Isn&#39;t clear that this function is potentially unsafe</span>
    <span class="n">Bank</span><span class="p">.</span><span class="n">withdraw</span><span class="p">(</span><span class="n">amount</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// good</span>
<span class="n">UntrustedBank</span><span class="p">.</span><span class="n">withdraw</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span> <span class="c1">// untrusted external call</span>
<span class="n">TrustedBank</span><span class="p">.</span><span class="n">withdraw</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span> <span class="c1">// external but trusted bank contract maintained by XYZ Corp</span>

<span class="kd">function</span> <span class="n">makeUntrustedWithdrawal</span><span class="p">(</span><span class="kt">uint</span> <span class="n">amount</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">UntrustedBank</span><span class="p">.</span><span class="n">withdraw</span><span class="p">(</span><span class="n">amount</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<hr />
<h4 id="avoid-state-changes-after-external-calls">Avoid state changes after external calls<a class="headerlink" href="#avoid-state-changes-after-external-calls" title="Permanent link">&para;</a></h4>
<p>Whether using <em>raw calls</em> (of the form <code>someAddress.call()</code>) or <em>contract calls</em> (of the form
<code>ExternalContract.someMethod()</code>), assume that malicious code might execute. Even if
<code>ExternalContract</code> is not malicious, malicious code can be executed by any contracts <em>it</em> calls.</p>
<p>One particular danger is malicious code may hijack the control flow, leading to vulnerabilities due
to reentrancy. (See <a href="./known_attacks#reentrancy">Reentrancy</a> for a fuller discussion of this
problem).</p>
<p>If you are making a call to an untrusted external contract, <em>avoid state changes after the call</em>.
This pattern is also sometimes known as the
<a href="http://solidity.readthedocs.io/en/develop/security-considerations.html?highlight=check%20effects#use-the-checks-effects-interactions-pattern">checks-effects-interactions pattern</a>.</p>
<p>See <a href="https://swcregistry.io/docs/SWC-107">SWC-107</a></p>
<hr />
<h4 id="dont-use-transfer-or-send">Don't use <code>transfer()</code> or <code>send()</code>.<a class="headerlink" href="#dont-use-transfer-or-send" title="Permanent link">&para;</a></h4>
<p><code>.transfer()</code> and <code>.send()</code> forward exactly 2,300 gas to the recipient. The goal of this hardcoded
gas stipend was to prevent <a href="./known_attacks#reentrancy">reentrancy vulnerabilities</a>, but this only
makes sense under the assumption that gas costs are constant. Recently
<a href="https://eips.ethereum.org/EIPS/eip-1884">EIP 1884</a> was included in the Istanbul hard fork. One of
the changes included in EIP 1884 is an increase to the gas cost of the <code>SLOAD</code> operation, causing a
contract's fallback function to cost more than 2300 gas.</p>
<p>It's recommended to stop using <code>.transfer()</code> and <code>.send()</code> and instead use <code>.call()</code>.</p>
<div class="highlight"><pre><span></span><code>// bad
contract Vulnerable {
    function withdraw(uint256 amount) external {
        // This forwards 2300 gas, which may not be enough if the recipient
        // is a contract and gas costs change.
        msg.sender.transfer(amount);
    }
}

// good
contract Fixed {
    function withdraw(uint256 amount) external {
        // This forwards all available gas. Be sure to check the return value!
        (bool success, ) = msg.sender.call.value(amount)(&quot;&quot;);
        require(success, &quot;Transfer failed.&quot;);
    }
}
</code></pre></div>
<p>Note that <code>.call()</code> does nothing to mitigate reentrancy attacks, so other precautions must be
taken. To prevent reentrancy attacks, it is recommended that you use the
<a href="https://solidity.readthedocs.io/en/develop/security-considerations.html?highlight=check%20effects#use-the-checks-effects-interactions-pattern">checks-effects-interactions pattern</a>.</p>
<hr />
<h4 id="handle-errors-in-external-calls">Handle errors in external calls<a class="headerlink" href="#handle-errors-in-external-calls" title="Permanent link">&para;</a></h4>
<p>Solidity offers low-level call methods that work on raw addresses: <code>address.call()</code>,
<code>address.callcode()</code>, <code>address.delegatecall()</code>, and <code>address.send()</code>. These low-level methods never
throw an exception, but will return <code>false</code> if the call encounters an exception. On the other hand,
<em>contract calls</em> (e.g., <code>ExternalContract.doSomething()</code>) will automatically propagate a throw (for
example, <code>ExternalContract.doSomething()</code> will also <code>throw</code> if <code>doSomething()</code> throws).</p>
<p>If you choose to use the low-level call methods, make sure to handle the possibility that the call
will fail, by checking the return value.</p>
<div class="highlight"><pre><span></span><code><span class="c1">// bad</span>
<span class="n">someAddress</span><span class="p">.</span><span class="nf">send</span><span class="p">(</span><span class="mi">55</span><span class="p">);</span>
<span class="n">someAddress</span><span class="p">.</span><span class="nf">call</span><span class="p">.</span><span class="n">value</span><span class="p">(</span><span class="mi">55</span><span class="p">)(</span><span class="s">&quot;&quot;</span><span class="p">);</span> <span class="c1">// this is doubly dangerous, as it will forward all remaining gas and doesn&#39;t check for result</span>
<span class="n">someAddress</span><span class="p">.</span><span class="nf">call</span><span class="p">.</span><span class="n">value</span><span class="p">(</span><span class="mi">100</span><span class="p">)(</span><span class="kt">bytes4</span><span class="p">(</span><span class="nf">sha3</span><span class="p">(</span><span class="s">&quot;deposit()&quot;</span><span class="p">)));</span> <span class="c1">// if deposit throws an exception, the raw call() will only return false and transaction will NOT be reverted</span>

<span class="c1">// good</span>
<span class="p">(</span><span class="kt">bool</span> <span class="n">success</span><span class="p">,</span> <span class="p">)</span> <span class="o">=</span> <span class="n">someAddress</span><span class="p">.</span><span class="nf">call</span><span class="p">.</span><span class="n">value</span><span class="p">(</span><span class="mi">55</span><span class="p">)(</span><span class="s">&quot;&quot;</span><span class="p">);</span>
<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">success</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// handle failure code</span>
<span class="p">}</span>

<span class="n">ExternalContract</span><span class="p">(</span><span class="n">someAddress</span><span class="p">).</span><span class="n">deposit</span><span class="p">.</span><span class="n">value</span><span class="p">(</span><span class="mi">100</span><span class="p">)();</span>
</code></pre></div>
<p>See <a href="https://swcregistry.io/docs/SWC-104">SWC-104</a></p>
<hr />
<h4 id="favor-pull-over-push-for-external-calls">Favor <em>pull</em> over <em>push</em> for external calls<a class="headerlink" href="#favor-pull-over-push-for-external-calls" title="Permanent link">&para;</a></h4>
<p>External calls can fail accidentally or deliberately. To minimize the damage caused by such
failures, it is often better to isolate each external call into its own transaction that can be
initiated by the recipient of the call. This is especially relevant for payments, where it is
better to let users withdraw funds rather than push funds to them automatically. (This also reduces
the chance of <a href="./known_attacks#dos-with-block-gas-limit">problems with the gas limit</a>.) Avoid
combining multiple ether transfers in a single transaction.</p>
<div class="highlight"><pre><span></span><code><span class="c1">// bad</span>
<span class="kd">contract</span> <span class="n">auction</span> <span class="p">{</span>
    <span class="kt">address</span> <span class="n">highestBidder</span><span class="p">;</span>
    <span class="kt">uint</span> <span class="n">highestBid</span><span class="p">;</span>

    <span class="kd">function</span> <span class="n">bid</span><span class="p">()</span> <span class="k">payable</span> <span class="p">{</span>
        <span class="nf">require</span><span class="p">(</span><span class="nb">msg.value</span> <span class="o">&gt;=</span> <span class="n">highestBid</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">highestBidder</span> <span class="o">!=</span> <span class="kt">address</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span> <span class="p">{</span>
            <span class="p">(</span><span class="kt">bool</span> <span class="n">success</span><span class="p">,</span> <span class="p">)</span> <span class="o">=</span> <span class="n">highestBidder</span><span class="p">.</span><span class="nf">call</span><span class="p">.</span><span class="n">value</span><span class="p">(</span><span class="n">highestBid</span><span class="p">)(</span><span class="s">&quot;&quot;</span><span class="p">);</span>
            <span class="nf">require</span><span class="p">(</span><span class="n">success</span><span class="p">);</span> <span class="c1">// if this call consistently fails, no one else can bid</span>
        <span class="p">}</span>

       <span class="n">highestBidder</span> <span class="o">=</span> <span class="nb">msg.sender</span><span class="p">;</span>
       <span class="n">highestBid</span> <span class="o">=</span> <span class="nb">msg.value</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// good</span>
<span class="kd">contract</span> <span class="n">auction</span> <span class="p">{</span>
    <span class="kt">address</span> <span class="n">highestBidder</span><span class="p">;</span>
    <span class="kt">uint</span> <span class="n">highestBid</span><span class="p">;</span>
    <span class="kd">mapping</span><span class="p">(</span><span class="kt">address</span> <span class="o">=&gt;</span> <span class="kt">uint</span><span class="p">)</span> <span class="n">refunds</span><span class="p">;</span>

    <span class="kd">function</span> <span class="n">bid</span><span class="p">()</span> <span class="k">payable</span> <span class="k">external</span> <span class="p">{</span>
        <span class="nf">require</span><span class="p">(</span><span class="nb">msg.value</span> <span class="o">&gt;=</span> <span class="n">highestBid</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">highestBidder</span> <span class="o">!=</span> <span class="kt">address</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span> <span class="p">{</span>
            <span class="n">refunds</span><span class="p">[</span><span class="n">highestBidder</span><span class="p">]</span> <span class="o">+=</span> <span class="n">highestBid</span><span class="p">;</span> <span class="c1">// record the refund that this user can claim</span>
        <span class="p">}</span>

        <span class="n">highestBidder</span> <span class="o">=</span> <span class="nb">msg.sender</span><span class="p">;</span>
        <span class="n">highestBid</span> <span class="o">=</span> <span class="nb">msg.value</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="n">withdrawRefund</span><span class="p">()</span> <span class="k">external</span> <span class="p">{</span>
        <span class="kt">uint</span> <span class="n">refund</span> <span class="o">=</span> <span class="n">refunds</span><span class="p">[</span><span class="nb">msg.sender</span><span class="p">];</span>
        <span class="n">refunds</span><span class="p">[</span><span class="nb">msg.sender</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="p">(</span><span class="kt">bool</span> <span class="n">success</span><span class="p">,</span> <span class="p">)</span> <span class="o">=</span> <span class="nb">msg.sender</span><span class="p">.</span><span class="nf">call</span><span class="p">.</span><span class="n">value</span><span class="p">(</span><span class="n">refund</span><span class="p">)(</span><span class="s">&quot;&quot;</span><span class="p">);</span>
        <span class="nf">require</span><span class="p">(</span><span class="n">success</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>See <a href="https://swcregistry.io/docs/SWC-128">SWC-128</a></p>
<hr />
<h4 id="dont-delegatecall-to-untrusted-code">Don't delegatecall to untrusted code<a class="headerlink" href="#dont-delegatecall-to-untrusted-code" title="Permanent link">&para;</a></h4>
<p>The <code>delegatecall</code> function is used to call functions from other contracts as if they belong to the
caller contract. Thus the callee may change the state of the calling address. This may be insecure.
An example below shows how using <code>delegatecall</code> can lead to the destruction of the contract and
loss of its balance.</p>
<div class="highlight"><pre><span></span><code><span class="kd">contract</span> <span class="n">Destructor</span>
<span class="p">{</span>
    <span class="kd">function</span> <span class="n">doWork</span><span class="p">()</span> <span class="k">external</span>
    <span class="p">{</span>
        <span class="nf">selfdestruct</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="n">Worker</span>
<span class="p">{</span>
    <span class="kd">function</span> <span class="n">doWork</span><span class="p">(</span><span class="kt">address</span> <span class="n">_internalWorker</span><span class="p">)</span> <span class="k">public</span>
    <span class="p">{</span>
        <span class="c1">// unsafe</span>
        <span class="n">_internalWorker</span><span class="p">.</span><span class="nf">delegatecall</span><span class="p">(</span><span class="kt">bytes4</span><span class="p">(</span><span class="nf">keccak256</span><span class="p">(</span><span class="s">&quot;doWork()&quot;</span><span class="p">)));</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>If <code>Worker.doWork()</code> is called with the address of the deployed <code>Destructor</code> contract as an
argument, the <code>Worker</code> contract will self-destruct. Delegate execution only to trusted contracts,
and <strong>never to a user supplied address</strong>.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Don't assume contracts are created with zero balance An attacker can send ether to the
address of a contract before it is created. Contracts should not assume that their initial state
contains a zero balance. See
<a href="https://github.com/ConsenSys/smart-contract-best-practices/issues/61">issue 61</a> for more details.</p>
<p>See <a href="https://swcregistry.io/docs/SWC-112">SWC-112</a></p>
</div>
<hr />
<h3 id="remember-that-ether-can-be-forcibly-sent-to-an-account">Remember that Ether can be forcibly sent to an account<a class="headerlink" href="#remember-that-ether-can-be-forcibly-sent-to-an-account" title="Permanent link">&para;</a></h3>
<p>Beware of coding an invariant that strictly checks the balance of a contract.</p>
<p>An attacker can forcibly send ether to any account and this cannot be prevented (not even with a
fallback function that does a <code>revert()</code>).</p>
<p>The attacker can do this by creating a contract, funding it with 1 wei, and invoking
<code>selfdestruct(victimAddress)</code>. No code is invoked in <code>victimAddress</code>, so it cannot be prevented.
This is also true for block reward which is sent to the address of the miner, which can be any
arbitrary address.</p>
<p>Also, since contract addresses can be precomputed, ether can be sent to an address before the
contract is deployed.</p>
<p>See <a href="https://swcregistry.io/docs/SWC-132">SWC-132</a></p>
<hr />
<h3 id="remember-that-on-chain-data-is-public">Remember that on-chain data is public<a class="headerlink" href="#remember-that-on-chain-data-is-public" title="Permanent link">&para;</a></h3>
<p>Many applications require submitted data to be private up until some point in time in order to
work. Games (eg. on-chain rock-paper-scissors) and auction mechanisms (eg. sealed-bid
<a href="https://en.wikipedia.org/wiki/Vickrey_auction">Vickrey auctions</a>) are two major categories of
examples. If you are building an application where privacy is an issue, make sure you avoid
requiring users to publish information too early. The best strategy is to use
<a href="https://en.wikipedia.org/wiki/Commitment_scheme">commitment schemes</a> with separate phases: first
commit using the hash of the values and in a later phase revealing the values.</p>
<p>Examples:</p>
<ul>
<li>In rock paper scissors, require both players to submit a hash of their intended move first, then
  require both players to submit their move; if the submitted move does not match the hash throw it
  out.</li>
<li>In an auction, require players to submit a hash of their bid value in an initial phase (along
  with a deposit greater than their bid value), and then submit their auction bid value in the
  second phase.</li>
<li>When developing an application that depends on a random number generator, the order should always
  be <em>(1)</em> players submit moves, <em>(2)</em> random number generated, <em>(3)</em> players paid out. The method
  by which random numbers are generated is itself an area of active research; current best-in-class
  solutions include Bitcoin block headers (verified through <a href="http://btcrelay.org">http://btcrelay.org</a>),
  hash-commit-reveal schemes (ie. one party generates a number, publishes its hash to "commit" to
  the value, and then reveals the value later) and <a href="http://github.com/randao/randao">RANDAO</a>. As
  Ethereum is a deterministic protocol, no variable within the protocol could be used as an
  unpredictable random number. Also, be aware that miners are in some extent in control of the
  <code>block.blockhash()</code>
  value<sup><a href='https://ethereum.stackexchange.com/questions/419/when-can-blockhash-be-safely-used-for-a-random-number-when-would-it-be-unsafe'>*</a></sup>.</li>
</ul>
<hr />
<h3 id="beware-of-the-possibility-that-some-participants-may-drop-offline-and-not-return">Beware of the possibility that some participants may "drop offline" and not return<a class="headerlink" href="#beware-of-the-possibility-that-some-participants-may-drop-offline-and-not-return" title="Permanent link">&para;</a></h3>
<p>Do not make refund or claim processes dependent on a specific party performing a particular action
with no other way of getting the funds out. For example, in a rock-paper-scissors game, one common
mistake is to not make a payout until both players submit their moves; however, a malicious player
can "grief" the other by simply never submitting their move - in fact, if a player sees the other
player's revealed move and determines that they lost, they have no reason to submit their own move
at all. This issue may also arise in the context of state channel settlement. When such situations
are an issue, (1) provide a way of circumventing non-participating participants, perhaps through a
time limit, and (2) consider adding economic incentive for participants to submit information in
all of the situations in which they are supposed to do so.</p>
<hr />
<h3 id="beware-of-negation-of-the-most-negative-signed-integer">Beware of negation of the most negative signed integer<a class="headerlink" href="#beware-of-negation-of-the-most-negative-signed-integer" title="Permanent link">&para;</a></h3>
<p>Solidity provides several types to work with signed integers. Like in most programming languages,
in Solidity a signed integer with <code>N</code> bits can represent values from <code>-2^(N-1)</code> to <code>2^(N-1)-1</code>.
This means that there is no positive equivalent for the <code>MIN_INT</code>. Negation is implemented as
finding the two's complement of a number, so the negation of the most negative number
<a href="https://en.wikipedia.org/wiki/Two%27s_complement#Most_negative_number">will result in the same number</a>.</p>
<p>This is true for all signed integer types in Solidity (<code>int8</code>, <code>int16</code>, ..., <code>int256</code>).</p>
<div class="highlight"><pre><span></span><code><span class="kd">contract</span> <span class="n">Negation</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="n">negate8</span><span class="p">(</span><span class="kt">int8</span> <span class="n">_i</span><span class="p">)</span> <span class="k">public</span> <span class="k">pure</span> <span class="k">returns</span><span class="p">(</span><span class="kt">int8</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">_i</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="n">negate16</span><span class="p">(</span><span class="kt">int16</span> <span class="n">_i</span><span class="p">)</span> <span class="k">public</span> <span class="k">pure</span> <span class="k">returns</span><span class="p">(</span><span class="kt">int16</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">_i</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kt">int8</span> <span class="k">public</span> <span class="n">a</span> <span class="o">=</span> <span class="n">negate8</span><span class="p">(</span><span class="o">-</span><span class="mi">128</span><span class="p">);</span> <span class="c1">// -128</span>
    <span class="kt">int16</span> <span class="k">public</span> <span class="n">b</span> <span class="o">=</span> <span class="n">negate16</span><span class="p">(</span><span class="o">-</span><span class="mi">128</span><span class="p">);</span> <span class="c1">// 128</span>
    <span class="kt">int16</span> <span class="k">public</span> <span class="n">c</span> <span class="o">=</span> <span class="n">negate16</span><span class="p">(</span><span class="o">-</span><span class="mi">32768</span><span class="p">);</span> <span class="c1">// -32768</span>
<span class="p">}</span>
</code></pre></div>
<p>One way to handle this is to check the value of a variable before negation and throw if it's equal
to the <code>MIN_INT</code>. Another option is to make sure that the most negative number will never be
achieved by using a type with a higher capacity (e.g. <code>int32</code> instead of <code>int16</code>).</p>
<p>A similar issue with <code>int</code> types occurs when <code>MIN_INT</code> is multiplied or divided by <code>-1</code>.</p>
<hr />
<h2 id="solidity-specific-recommendations">Solidity specific recommendations<a class="headerlink" href="#solidity-specific-recommendations" title="Permanent link">&para;</a></h2>
<p>The following recommendations are specific to Solidity, but may also be instructive for developing
smart contracts in other languages.</p>
<h3 id="enforce-invariants-with-assert">Enforce invariants with <code>assert()</code><a class="headerlink" href="#enforce-invariants-with-assert" title="Permanent link">&para;</a></h3>
<p>An assert guard triggers when an assertion fails - such as an invariant property changing. For
example, the token to ether issuance ratio, in a token issuance contract, may be fixed. You can
verify that this is the case at all times with an <code>assert()</code>. Assert guards should often be
combined with other techniques, such as pausing the contract and allowing upgrades. (Otherwise, you
may end up stuck, with an assertion that is always failing.)</p>
<p>Example:</p>
<div class="highlight"><pre><span></span><code><span class="kd">contract</span> <span class="n">Token</span> <span class="p">{</span>
    <span class="kd">mapping</span><span class="p">(</span><span class="kt">address</span> <span class="o">=&gt;</span> <span class="kt">uint</span><span class="p">)</span> <span class="k">public</span> <span class="n">balanceOf</span><span class="p">;</span>
    <span class="kt">uint</span> <span class="k">public</span> <span class="n">totalSupply</span><span class="p">;</span>

    <span class="kd">function</span> <span class="n">deposit</span><span class="p">()</span> <span class="k">public</span> <span class="k">payable</span> <span class="p">{</span>
        <span class="n">balanceOf</span><span class="p">[</span><span class="nb">msg.sender</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">msg.value</span><span class="p">;</span>
        <span class="n">totalSupply</span> <span class="o">+=</span> <span class="nb">msg.value</span><span class="p">;</span>
        <span class="nf">assert</span><span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="nb">this</span><span class="p">).</span><span class="nb">balance</span> <span class="o">&gt;=</span> <span class="n">totalSupply</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Note that the assertion is <em>not</em> a strict equality of the balance because the contract can be
<a href="#remember-that-ether-can-be-forcibly-sent-to-an-account">forcibly sent ether</a> without going
through the <code>deposit()</code> function!</p>
<hr />
<h3 id="use-assert-require-revert-properly">Use <code>assert()</code>, <code>require()</code>, <code>revert()</code> properly<a class="headerlink" href="#use-assert-require-revert-properly" title="Permanent link">&para;</a></h3>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>The convenience functions <strong>assert</strong> and <strong>require</strong> can be used to check for conditions and throw an exception if the condition is not met.</p>
</div>
<p>The <strong>assert</strong> function should only be used to test for internal errors, and to check invariants.</p>
<p>The <strong>require</strong> function should be used to ensure valid conditions, such as inputs, or contract state variables are met, or to validate return values from calls to external contracts. <sup><a href='https://solidity.readthedocs.io/en/latest/control-structures.html#error-handling-assert-require-revert-and-exceptions'>*</a></sup></p>
<p>Following this paradigm allows formal analysis tools to verify that the invalid opcode can never be
reached: meaning no invariants in the code are violated and that the code is formally verified.</p>
<div class="highlight"><pre><span></span><code><span class="k">pragma solidity</span> <span class="o">^</span><span class="mf">0.5</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">Sharer</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="n">sendHalf</span><span class="p">(</span><span class="kt">address</span> <span class="k">payable</span> <span class="n">addr</span><span class="p">)</span> <span class="k">public</span> <span class="k">payable</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span> <span class="nb">balance</span><span class="p">)</span> <span class="p">{</span>
        <span class="nf">require</span><span class="p">(</span><span class="nb">msg.value</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;Even value required.&quot;</span><span class="p">);</span> <span class="c1">//Require() can have an optional message string</span>
        <span class="kt">uint</span> <span class="n">balanceBeforeTransfer</span> <span class="o">=</span> <span class="kt">address</span><span class="p">(</span><span class="nb">this</span><span class="p">).</span><span class="nb">balance</span><span class="p">;</span>
        <span class="p">(</span><span class="kt">bool</span> <span class="n">success</span><span class="p">,</span> <span class="p">)</span> <span class="o">=</span> <span class="n">addr</span><span class="p">.</span><span class="nf">call</span><span class="p">.</span><span class="n">value</span><span class="p">(</span><span class="nb">msg.value</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)(</span><span class="s">&quot;&quot;</span><span class="p">);</span>
        <span class="nf">require</span><span class="p">(</span><span class="n">success</span><span class="p">);</span>
        <span class="c1">// Since we reverted if the transfer failed, there should be</span>
        <span class="c1">// no way for us to still have half of the money.</span>
        <span class="nf">assert</span><span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="nb">this</span><span class="p">).</span><span class="nb">balance</span> <span class="o">==</span> <span class="n">balanceBeforeTransfer</span> <span class="o">-</span> <span class="nb">msg.value</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span> <span class="c1">// used for internal error checking</span>
        <span class="k">return</span> <span class="kt">address</span><span class="p">(</span><span class="nb">this</span><span class="p">).</span><span class="nb">balance</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>See <a href="https://swcregistry.io/docs/SWC-110">SWC-110</a> &amp; <a href="https://swcregistry.io/docs/SWC-123">SWC-123</a></p>
<hr />
<h3 id="use-modifiers-only-for-checks">Use modifiers only for checks<a class="headerlink" href="#use-modifiers-only-for-checks" title="Permanent link">&para;</a></h3>
<p>The code inside a modifier is usually executed before the function body, so any state changes or
external calls will violate the
<a href="https://solidity.readthedocs.io/en/develop/security-considerations.html#use-the-checks-effects-interactions-pattern">Checks-Effects-Interactions</a>
pattern. Moreover, these statements may also remain unnoticed by the developer, as the code for
modifier may be far from the function declaration. For example, an external call in modifier can
lead to the reentrancy attack:</p>
<div class="highlight"><pre><span></span><code><span class="kd">contract</span> <span class="n">Registry</span> <span class="p">{</span>
    <span class="kt">address</span> <span class="n">owner</span><span class="p">;</span>

    <span class="kd">function</span> <span class="n">isVoter</span><span class="p">(</span><span class="kt">address</span> <span class="n">_addr</span><span class="p">)</span> <span class="k">external</span> <span class="k">returns</span><span class="p">(</span><span class="kt">bool</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Code</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="n">Election</span> <span class="p">{</span>
    <span class="n">Registry</span> <span class="n">registry</span><span class="p">;</span>

    <span class="kd">modifier</span> <span class="n">isEligible</span><span class="p">(</span><span class="kt">address</span> <span class="n">_addr</span><span class="p">)</span> <span class="p">{</span>
        <span class="nf">require</span><span class="p">(</span><span class="n">registry</span><span class="p">.</span><span class="n">isVoter</span><span class="p">(</span><span class="n">_addr</span><span class="p">));</span>
        <span class="k">_</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="n">vote</span><span class="p">()</span> <span class="n">isEligible</span><span class="p">(</span><span class="nb">msg.sender</span><span class="p">)</span> <span class="k">public</span> <span class="p">{</span>
        <span class="c1">// Code</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>In this case, the <code>Registry</code> contract can make a reentrancy attack by calling <code>Election.vote()</code>
inside <code>isVoter()</code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Use <a href="https://solidity.readthedocs.io/en/develop/contracts.html#function-modifiers">modifiers</a> to
replace duplicate condition checks in multiple functions, such as <code>isOwner()</code>, otherwise use
<code>require</code> or <code>revert</code> inside the function. This makes your smart contract code more readable and
easier to audit.</p>
</div>
<hr />
<h3 id="beware-rounding-with-integer-division">Beware rounding with integer division<a class="headerlink" href="#beware-rounding-with-integer-division" title="Permanent link">&para;</a></h3>
<p>All integer division rounds down to the nearest integer. If you need more precision, consider using
a multiplier, or store both the numerator and denominator.</p>
<p>(In the future, Solidity will have a
<a href="https://solidity.readthedocs.io/en/develop/types.html#fixed-point-numbers">fixed-point</a> type,
which will make this easier.)</p>
<div class="highlight"><pre><span></span><code><span class="c1">// bad</span>
<span class="kt">uint</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">5</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span> <span class="c1">// Result is 2, all integer division rounds DOWN to the nearest integer</span>
</code></pre></div>
<p>Using a multiplier prevents rounding down, this multiplier needs to be accounted for when working
with x in the future:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// good</span>
<span class="kt">uint</span> <span class="n">multiplier</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
<span class="kt">uint</span> <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span> <span class="o">*</span> <span class="n">multiplier</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
</code></pre></div>
<p>Storing the numerator and denominator means you can calculate the result of <code>numerator/denominator</code>
off-chain:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// good</span>
<span class="kt">uint</span> <span class="n">numerator</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
<span class="kt">uint</span> <span class="n">denominator</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
</code></pre></div>
<hr />
<h3 id="be-aware-of-the-tradeoffs-between-abstract-contracts-and-interfaces">Be aware of the tradeoffs between <strong>abstract contracts</strong> and <strong>interfaces</strong><a class="headerlink" href="#be-aware-of-the-tradeoffs-between-abstract-contracts-and-interfaces" title="Permanent link">&para;</a></h3>
<p>Both interfaces and abstract contracts provide one with a customizable and re-usable approach for
smart contracts. Interfaces, which were introduced in Solidity 0.4.11, are similar to abstract
contracts but cannot have any functions implemented. Interfaces also have limitations such as not
being able to access storage or inherit from other interfaces which generally makes abstract
contracts more practical. Although, interfaces are certainly useful for designing contracts prior
to implementation. Additionally, it is important to keep in mind that if a contract inherits from
an abstract contract it must implement all non-implemented functions via overriding or it will be
abstract as well.</p>
<hr />
<h3 id="fallback-functions">Fallback Functions<a class="headerlink" href="#fallback-functions" title="Permanent link">&para;</a></h3>
<h4 id="keep-fallback-functions-simple">Keep fallback functions simple<a class="headerlink" href="#keep-fallback-functions-simple" title="Permanent link">&para;</a></h4>
<p><a href="http://solidity.readthedocs.io/en/latest/contracts.html#fallback-function">Fallback functions</a> are
called when a contract is sent a message with no arguments (or when no function matches), and only
has access to 2,300 gas when called from a <code>.send()</code> or <code>.transfer()</code>. If you wish to be able to
receive Ether from a <code>.send()</code> or <code>.transfer()</code>, the most you can do in a fallback function is log
an event. Use a proper function if a computation of more gas is required.</p>
<div class="highlight"><pre><span></span><code><span class="c1">// bad</span>
<span class="kd">function</span><span class="p">()</span> <span class="k">payable</span> <span class="p">{</span> <span class="n">balances</span><span class="p">[</span><span class="nb">msg.sender</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">msg.value</span><span class="p">;</span> <span class="p">}</span>

<span class="c1">// good</span>
<span class="kd">function</span> <span class="n">deposit</span><span class="p">()</span> <span class="k">payable</span> <span class="k">external</span> <span class="p">{</span> <span class="n">balances</span><span class="p">[</span><span class="nb">msg.sender</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">msg.value</span><span class="p">;</span> <span class="p">}</span>

<span class="kd">function</span><span class="p">()</span> <span class="k">payable</span> <span class="p">{</span> <span class="nf">require</span><span class="p">(</span><span class="nb">msg.data</span><span class="p">.</span><span class="n">length</span> <span class="o">==</span> <span class="mi">0</span><span class="p">);</span> <span class="k">emit</span> <span class="n">LogDepositReceived</span><span class="p">(</span><span class="nb">msg.sender</span><span class="p">);</span> <span class="p">}</span>
</code></pre></div>
<h4 id="check-data-length-in-fallback-functions">Check data length in fallback functions<a class="headerlink" href="#check-data-length-in-fallback-functions" title="Permanent link">&para;</a></h4>
<p>Since the
<a href="http://solidity.readthedocs.io/en/latest/contracts.html#fallback-function">fallback functions</a> is
not only called for plain ether transfers (without data) but also when no other function matches,
you should check that the data is empty if the fallback function is intended to be used only for
the purpose of logging received Ether. Otherwise, callers will not notice if your contract is used
incorrectly and functions that do not exist are called.</p>
<div class="highlight"><pre><span></span><code><span class="c1">// bad</span>
<span class="kd">function</span><span class="p">()</span> <span class="k">payable</span> <span class="p">{</span> <span class="k">emit</span> <span class="n">LogDepositReceived</span><span class="p">(</span><span class="nb">msg.sender</span><span class="p">);</span> <span class="p">}</span>

<span class="c1">// good</span>
<span class="kd">function</span><span class="p">()</span> <span class="k">payable</span> <span class="p">{</span> <span class="nf">require</span><span class="p">(</span><span class="nb">msg.data</span><span class="p">.</span><span class="n">length</span> <span class="o">==</span> <span class="mi">0</span><span class="p">);</span> <span class="k">emit</span> <span class="n">LogDepositReceived</span><span class="p">(</span><span class="nb">msg.sender</span><span class="p">);</span> <span class="p">}</span>
</code></pre></div>
<hr />
<h3 id="explicitly-mark-payable-functions-and-state-variables">Explicitly mark payable functions and state variables<a class="headerlink" href="#explicitly-mark-payable-functions-and-state-variables" title="Permanent link">&para;</a></h3>
<p>Starting from Solidity <code>0.4.0</code>, every function that is receiving ether must use <code>payable</code> modifier,
otherwise if the transaction has <code>msg.value &gt; 0</code> will revert
(<a href="./recommendations/#remember-that-ether-can-be-forcibly-sent-to-an-account">except when forced</a>).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Something that might not be obvious: The <code>payable</code> modifier only applies to calls from <em>external</em> contracts. If I call a non-payable function in the payable function in the same contract, the non-payable function won't fail, though <code>msg.value</code> is still set.</p>
</div>
<h3 id="explicitly-mark-visibility-in-functions-and-state-variables">Explicitly mark visibility in functions and state variables<a class="headerlink" href="#explicitly-mark-visibility-in-functions-and-state-variables" title="Permanent link">&para;</a></h3>
<p>Explicitly label the visibility of functions and state variables. Functions can be specified as
being <code>external</code>, <code>public</code>, <code>internal</code> or <code>private</code>. Please understand the differences between
them, for example, <code>external</code> may be sufficient instead of <code>public</code>. For state variables,
<code>external</code> is not possible. Labeling the visibility explicitly will make it easier to catch
incorrect assumptions about who can call the function or access the variable.</p>
<ul>
<li><code>External</code> functions are part of the contract interface. An external function <code>f</code> cannot be
  called internally (i.e. <code>f()</code> does not work, but <code>this.f()</code> works). External functions are
  sometimes more efficient when they receive large arrays of data.</li>
<li><code>Public</code> functions are part of the contract interface and can be either called internally or via
  messages. For public state variables, an automatic getter function (see below) is generated.</li>
<li><code>Internal</code> functions and state variables can only be accessed internally, without using <code>this</code>.</li>
<li><code>Private</code> functions and state variables are only visible for the contract they are defined in and
  not in derived contracts. <strong>Note</strong>: Everything that is inside a contract is visible to all
  observers external to the blockchain, even <code>Private</code>
  variables.<sup><a href='https://solidity.readthedocs.io/en/develop/contracts.html?#visibility-and-getters'>*</a></sup></li>
</ul>
<div class="highlight"><pre><span></span><code><span class="c1">// bad</span>
<span class="kt">uint</span> <span class="n">x</span><span class="p">;</span> <span class="c1">// the default is internal for state variables, but it should be made explicit</span>
<span class="kd">function</span> <span class="n">buy</span><span class="p">()</span> <span class="p">{</span> <span class="c1">// the default is public</span>
    <span class="c1">// public code</span>
<span class="p">}</span>

<span class="c1">// good</span>
<span class="kt">uint</span> <span class="k">private</span> <span class="n">y</span><span class="p">;</span>
<span class="kd">function</span> <span class="n">buy</span><span class="p">()</span> <span class="k">external</span> <span class="p">{</span>
    <span class="c1">// only callable externally or using this.buy()</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="n">utility</span><span class="p">()</span> <span class="k">public</span> <span class="p">{</span>
    <span class="c1">// callable externally, as well as internally: changing this code requires thinking about both cases.</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="n">internalAction</span><span class="p">()</span> <span class="k">internal</span> <span class="p">{</span>
    <span class="c1">// internal code</span>
<span class="p">}</span>
</code></pre></div>
<p>See <a href="https://swcregistry.io/docs/SWC-100">SWC-100</a> and
<a href="https://swcregistry.io/docs/SWC-108">SWC-108</a></p>
<hr />
<h3 id="lock-pragmas-to-specific-compiler-version">Lock pragmas to specific compiler version<a class="headerlink" href="#lock-pragmas-to-specific-compiler-version" title="Permanent link">&para;</a></h3>
<p>Contracts should be deployed with the same compiler version and flags that they have been tested
the most with. Locking the pragma helps ensure that contracts do not accidentally get deployed
using, for example, the latest compiler which may have higher risks of undiscovered bugs. Contracts
may also be deployed by others and the pragma indicates the compiler version intended by the
original authors.</p>
<div class="highlight"><pre><span></span><code><span class="c1">// bad</span>
<span class="k">pragma solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">4</span><span class="p">;</span>


<span class="c1">// good</span>
<span class="k">pragma solidity</span> <span class="mf">0.4</span><span class="p">.</span><span class="mi">4</span><span class="p">;</span>
</code></pre></div>
<p>Note: a floating pragma version (ie. <code>^0.4.25</code>) will compile fine with <code>0.4.26-nightly.2018.9.25</code>,
however nightly builds should never be used to compile code for production.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Pragma statements can be allowed to float when a contract is intended for consumption
by other developers, as in the case with contracts in a library or EthPM package. Otherwise, the
developer would need to manually update the pragma in order to compile locally.</p>
<p>See <a href="https://swcregistry.io/docs/SWC-103">SWC-103</a></p>
</div>
<hr />
<h3 id="use-events-to-monitor-contract-activity">Use events to monitor contract activity<a class="headerlink" href="#use-events-to-monitor-contract-activity" title="Permanent link">&para;</a></h3>
<p>It can be useful to have a way to monitor the contract's activity after it was deployed. One way to
accomplish this is to look at all transactions of the contract, however that may be insufficient,
as message calls between contracts are not recorded in the blockchain. Moreover, it shows only the
input parameters, not the actual changes being made to the state. Also, events could be used to
trigger functions in the user interface.</p>
<div class="highlight"><pre><span></span><code><span class="kd">contract</span> <span class="n">Charity</span> <span class="p">{</span>
    <span class="kd">mapping</span><span class="p">(</span><span class="kt">address</span> <span class="o">=&gt;</span> <span class="kt">uint</span><span class="p">)</span> <span class="n">balances</span><span class="p">;</span>

    <span class="kd">function</span> <span class="n">donate</span><span class="p">()</span> <span class="k">payable</span> <span class="k">public</span> <span class="p">{</span>
        <span class="n">balances</span><span class="p">[</span><span class="nb">msg.sender</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">msg.value</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="n">Game</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="n">buyCoins</span><span class="p">()</span> <span class="k">payable</span> <span class="k">public</span> <span class="p">{</span>
        <span class="c1">// 5% goes to charity</span>
        <span class="n">charity</span><span class="p">.</span><span class="n">donate</span><span class="p">.</span><span class="n">value</span><span class="p">(</span><span class="nb">msg.value</span> <span class="o">/</span> <span class="mi">20</span><span class="p">)();</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Here, <code>Game</code> contract will make an internal call to <code>Charity.donate()</code>. This transaction won't
appear in the external transaction list of <code>Charity</code>, but only visible in the internal
transactions.</p>
<p>An event is a convenient way to log something that happened in the contract. Events that were
emitted stay in the blockchain along with the other contract data and they are available for future
audit. Here is an improvement to the example above, using events to provide a history of the
Charity's donations.</p>
<div class="highlight"><pre><span></span><code><span class="kd">contract</span> <span class="n">Charity</span> <span class="p">{</span>
    <span class="c1">// define event</span>
    <span class="kd">event</span> <span class="n">LogDonate</span><span class="p">(</span><span class="kt">uint</span> <span class="n">_amount</span><span class="p">);</span>

    <span class="kd">mapping</span><span class="p">(</span><span class="kt">address</span> <span class="o">=&gt;</span> <span class="kt">uint</span><span class="p">)</span> <span class="n">balances</span><span class="p">;</span>

    <span class="kd">function</span> <span class="n">donate</span><span class="p">()</span> <span class="k">payable</span> <span class="k">public</span> <span class="p">{</span>
        <span class="n">balances</span><span class="p">[</span><span class="nb">msg.sender</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">msg.value</span><span class="p">;</span>
        <span class="c1">// emit event</span>
        <span class="k">emit</span> <span class="n">LogDonate</span><span class="p">(</span><span class="nb">msg.value</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="n">Game</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="n">buyCoins</span><span class="p">()</span> <span class="k">payable</span> <span class="k">public</span> <span class="p">{</span>
        <span class="c1">// 5% goes to charity</span>
        <span class="n">charity</span><span class="p">.</span><span class="n">donate</span><span class="p">.</span><span class="n">value</span><span class="p">(</span><span class="nb">msg.value</span> <span class="o">/</span> <span class="mi">20</span><span class="p">)();</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Here, all transactions that go through the <code>Charity</code> contract, either directly or not, will show up
in the event list of that contract along with the amount of donated money.</p>
<hr />
<div class="admonition note">
<p class="admonition-title">Prefer newer Solidity constructs</p>
<p>Prefer constructs/aliases such as <code>selfdestruct</code> (over <code>suicide</code>) and <code>keccak256</code> (over <code>sha3</code>).  Patterns like <code>require(msg.sender.send(1 ether))</code> can also be simplified to using <code>transfer()</code>, as in <code>msg.sender.transfer(1 ether)</code>. Check out <a href="https://github.com/ethereum/solidity/blob/develop/Changelog.md">Solidity Change log</a> for more similar changes.</p>
</div>
<hr />
<h3 id="be-aware-that-built-ins-can-be-shadowed">Be aware that 'Built-ins' can be shadowed<a class="headerlink" href="#be-aware-that-built-ins-can-be-shadowed" title="Permanent link">&para;</a></h3>
<p>It is currently possible to <a href="https://en.wikipedia.org/wiki/Variable_shadowing">shadow</a> built-in
globals in Solidity. This allows contracts to override the functionality of built-ins such as <code>msg</code>
and <code>revert()</code>. Although this <a href="https://github.com/ethereum/solidity/issues/1249">is intended</a>, it
can mislead users of a contract as to the contract's true behavior.</p>
<div class="highlight"><pre><span></span><code><span class="kd">contract</span> <span class="n">PretendingToRevert</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nf">revert</span><span class="p">()</span> <span class="k">internal</span> <span class="k">constant</span> <span class="p">{}</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="n">ExampleContract</span> <span class="k">is</span> <span class="n">PretendingToRevert</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="n">somethingBad</span><span class="p">()</span> <span class="k">public</span> <span class="p">{</span>
        <span class="nf">revert</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Contract users (and auditors) should be aware of the full smart contract source code of any
application they intend to use.</p>
<h3 id="avoid-using-txorigin">Avoid using <code>tx.origin</code><a class="headerlink" href="#avoid-using-txorigin" title="Permanent link">&para;</a></h3>
<p>Never use <code>tx.origin</code> for authorization, another contract can have a method which will call your
contract (where the user has some funds for instance) and your contract will authorize that
transaction as your address is in <code>tx.origin</code>.</p>
<div class="highlight"><pre><span></span><code><span class="kd">contract</span> <span class="n">MyContract</span> <span class="p">{</span>

    <span class="kt">address</span> <span class="n">owner</span><span class="p">;</span>

    <span class="kd">function</span> <span class="n">MyContract</span><span class="p">()</span> <span class="k">public</span> <span class="p">{</span>
        <span class="n">owner</span> <span class="o">=</span> <span class="nb">msg.sender</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="n">sendTo</span><span class="p">(</span><span class="kt">address</span> <span class="n">receiver</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">amount</span><span class="p">)</span> <span class="k">public</span> <span class="p">{</span>
        <span class="nf">require</span><span class="p">(</span><span class="nb">tx.origin</span> <span class="o">==</span> <span class="n">owner</span><span class="p">);</span>
        <span class="p">(</span><span class="kt">bool</span> <span class="n">success</span><span class="p">,</span> <span class="p">)</span> <span class="o">=</span> <span class="n">receiver</span><span class="p">.</span><span class="nf">call</span><span class="p">.</span><span class="n">value</span><span class="p">(</span><span class="n">amount</span><span class="p">)(</span><span class="s">&quot;&quot;</span><span class="p">);</span>
        <span class="nf">require</span><span class="p">(</span><span class="n">success</span><span class="p">);</span>
    <span class="p">}</span>

<span class="p">}</span>

<span class="kd">contract</span> <span class="n">AttackingContract</span> <span class="p">{</span>

    <span class="n">MyContract</span> <span class="n">myContract</span><span class="p">;</span>
    <span class="kt">address</span> <span class="n">attacker</span><span class="p">;</span>

    <span class="kd">function</span> <span class="n">AttackingContract</span><span class="p">(</span><span class="kt">address</span> <span class="n">myContractAddress</span><span class="p">)</span> <span class="k">public</span> <span class="p">{</span>
        <span class="n">myContract</span> <span class="o">=</span> <span class="n">MyContract</span><span class="p">(</span><span class="n">myContractAddress</span><span class="p">);</span>
        <span class="n">attacker</span> <span class="o">=</span> <span class="nb">msg.sender</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span><span class="p">()</span> <span class="k">public</span> <span class="p">{</span>
        <span class="n">myContract</span><span class="p">.</span><span class="n">sendTo</span><span class="p">(</span><span class="n">attacker</span><span class="p">,</span> <span class="nb">msg.sender</span><span class="p">.</span><span class="nb">balance</span><span class="p">);</span>
    <span class="p">}</span>

<span class="p">}</span>
</code></pre></div>
<p>You should use <code>msg.sender</code> for authorization (if another contract calls your contract <code>msg.sender</code>
will be the address of the contract and not the address of the user who called the contract).</p>
<p>You can read more about it here:
<a href="https://solidity.readthedocs.io/en/develop/security-considerations.html#tx-origin">Solidity docs</a></p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Besides the issue with authorization, there is a chance that <code>tx.origin</code> will be
removed from the Ethereum protocol in the future, so code that uses <code>tx.origin</code> won't be compatible
with future releases
<a href="https://ethereum.stackexchange.com/questions/196/how-do-i-make-my-dapp-serenity-proof/200#200">Vitalik: 'Do NOT assume that tx.origin will continue to be usable or meaningful.'</a></p>
<p>It's also worth mentioning that by using <code>tx.origin</code> you're limiting interoperability between
contracts because the contract that uses tx.origin cannot be used by another contract as a contract
can't be the <code>tx.origin</code>.</p>
<p>See <a href="https://swcregistry.io/docs/SWC-115">SWC-115</a></p>
</div>
<hr />
<h3 id="timestamp-dependence">Timestamp Dependence<a class="headerlink" href="#timestamp-dependence" title="Permanent link">&para;</a></h3>
<p>There are three main considerations when using a timestamp to execute a critical function in a
contract, especially when actions involve fund transfer.</p>
<h4 id="timestamp-manipulation">Timestamp Manipulation<a class="headerlink" href="#timestamp-manipulation" title="Permanent link">&para;</a></h4>
<p>Be aware that the timestamp of the block can be manipulated by a miner. Consider this
<a href="https://etherscan.io/address/0xcac337492149bdb66b088bf5914bedfbf78ccc18#code">contract</a>:</p>
<div class="highlight"><pre><span></span><code><span class="kt">uint256</span> <span class="k">constant</span> <span class="k">private</span> <span class="n">salt</span> <span class="o">=</span>  <span class="nb">block.timestamp</span><span class="p">;</span>

<span class="kd">function</span> <span class="n">random</span><span class="p">(</span><span class="kt">uint</span> <span class="n">Max</span><span class="p">)</span> <span class="k">constant</span> <span class="k">private</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint256</span> <span class="n">result</span><span class="p">){</span>
    <span class="c1">//get the best seed for randomness</span>
    <span class="kt">uint256</span> <span class="n">x</span> <span class="o">=</span> <span class="n">salt</span> <span class="o">*</span> <span class="mi">100</span><span class="o">/</span><span class="n">Max</span><span class="p">;</span>
    <span class="kt">uint256</span> <span class="n">y</span> <span class="o">=</span> <span class="n">salt</span> <span class="o">*</span> <span class="nb">block.number</span><span class="o">/</span><span class="p">(</span><span class="n">salt</span> <span class="o">%</span> <span class="mi">5</span><span class="p">)</span> <span class="p">;</span>
    <span class="kt">uint256</span> <span class="n">seed</span> <span class="o">=</span> <span class="nb">block.number</span><span class="o">/</span><span class="mi">3</span> <span class="o">+</span> <span class="p">(</span><span class="n">salt</span> <span class="o">%</span> <span class="mi">300</span><span class="p">)</span> <span class="o">+</span> <span class="n">Last_Payout</span> <span class="o">+</span> <span class="n">y</span><span class="p">;</span>
    <span class="kt">uint256</span> <span class="n">h</span> <span class="o">=</span> <span class="kt">uint256</span><span class="p">(</span><span class="nb">block.blockhash</span><span class="p">(</span><span class="n">seed</span><span class="p">));</span>

    <span class="k">return</span> <span class="kt">uint256</span><span class="p">((</span><span class="n">h</span> <span class="o">/</span> <span class="n">x</span><span class="p">))</span> <span class="o">%</span> <span class="n">Max</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">//random number between 1 and Max</span>
<span class="p">}</span>
</code></pre></div>
<p>When the contract uses the timestamp to seed a random number, the miner can actually post a
timestamp within 15 seconds of the block being validated, effectively allowing the miner to
precompute an option more favorable to their chances in the lottery. Timestamps are not random and
should not be used in that context.</p>
<h4 id="the-15-second-rule">The 15-second Rule<a class="headerlink" href="#the-15-second-rule" title="Permanent link">&para;</a></h4>
<p>The <a href="https://ethereum.github.io/yellowpaper/paper.pdf">Yellow Paper</a> (Ethereum's reference
specification) does not specify a constraint on how much blocks can drift in time, but
<a href="https://ethereum.stackexchange.com/a/5926/46821">it does specify</a> that each timestamp should be
bigger than the timestamp of its parent. Popular Ethereum protocol implementations
<a href="https://github.com/ethereum/go-ethereum/blob/4e474c74dc2ac1d26b339c32064d0bac98775e77/consensus/ethash/consensus.go#L45">Geth</a>
and
<a href="https://github.com/paritytech/parity-ethereum/blob/73db5dda8c0109bb6bc1392624875078f973be14/ethcore/src/verification/verification.rs#L296-L307">Parity</a>
both reject blocks with timestamp more than 15 seconds in future. Therefore, a good rule of thumb
in evaluating timestamp usage is:</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If the scale of your time-dependent event can vary by 15 seconds and maintain integrity,
it is safe to use a <code>block.timestamp</code>.</p>
</div>
<h4 id="avoid-using-blocknumber-as-a-timestamp">Avoid using <code>block.number</code> as a timestamp<a class="headerlink" href="#avoid-using-blocknumber-as-a-timestamp" title="Permanent link">&para;</a></h4>
<p>It is possible to estimate a time delta using the <code>block.number</code> property and
<a href="https://etherscan.io/chart/blocktime">average block time</a>, however this is not future proof as
block times may change (such as
<a href="https://blog.ethereum.org/2015/08/08/chain-reorganisation-depth-expectations/">fork reorganisations</a>
and the <a href="https://github.com/ethereum/EIPs/issues/649">difficulty bomb</a>). In a sale spanning days,
the 15-second rule allows one to achieve a more reliable estimate of time.</p>
<p>See <a href="https://swcregistry.io/docs/SWC-116">SWC-116</a></p>
<hr />
<h3 id="multiple-inheritance-caution">Multiple Inheritance Caution<a class="headerlink" href="#multiple-inheritance-caution" title="Permanent link">&para;</a></h3>
<p>When utilizing multiple inheritance in Solidity, it is important to understand how the compiler
composes the inheritance graph.</p>
<div class="highlight"><pre><span></span><code><span class="kd">contract</span> <span class="n">Final</span> <span class="p">{</span>
    <span class="kt">uint</span> <span class="k">public</span> <span class="n">a</span><span class="p">;</span>
    <span class="kd">function</span> <span class="n">Final</span><span class="p">(</span><span class="kt">uint</span> <span class="n">f</span><span class="p">)</span> <span class="k">public</span> <span class="p">{</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">f</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="n">B</span> <span class="k">is</span> <span class="n">Final</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="k">public</span> <span class="n">fee</span><span class="p">;</span>

    <span class="kd">function</span> <span class="n">B</span><span class="p">(</span><span class="kt">uint</span> <span class="n">f</span><span class="p">)</span> <span class="n">Final</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="k">public</span> <span class="p">{</span>
    <span class="p">}</span>
    <span class="kd">function</span> <span class="n">setFee</span><span class="p">()</span> <span class="k">public</span> <span class="p">{</span>
        <span class="n">fee</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="n">C</span> <span class="k">is</span> <span class="n">Final</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="k">public</span> <span class="n">fee</span><span class="p">;</span>

    <span class="kd">function</span> <span class="n">C</span><span class="p">(</span><span class="kt">uint</span> <span class="n">f</span><span class="p">)</span> <span class="n">Final</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="k">public</span> <span class="p">{</span>
    <span class="p">}</span>
    <span class="kd">function</span> <span class="n">setFee</span><span class="p">()</span> <span class="k">public</span> <span class="p">{</span>
        <span class="n">fee</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="n">A</span> <span class="k">is</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span> <span class="p">{</span>
  <span class="kd">function</span> <span class="n">A</span><span class="p">()</span> <span class="k">public</span> <span class="n">B</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="n">C</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">setFee</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>When a contract is deployed, the compiler will <em>linearize</em> the inheritance from right to left
(after the keyword <em>is</em> the parents are listed from the most base-like to the most derived). Here
is contract A's linearization:</p>
<p><strong>Final \&lt;- B \&lt;- C \&lt;- A</strong></p>
<p>The consequence of the linearization will yield a <code>fee</code> value of 5, since C is the most derived
contract. This may seem obvious, but imagine scenarios where C is able to shadow crucial functions,
reorder boolean clauses, and cause the developer to write exploitable contracts. Static analysis
currently does not raise issue with overshadowed functions, so it must be manually inspected.</p>
<p>For more on security and inheritance, check out this
<a href="https://pdaian.com/blog/solidity-anti-patterns-fun-with-inheritance-dag-abuse/">article</a></p>
<p>To help contribute, Solidity's Github has a
<a href="https://github.com/ethereum/solidity/projects/9#card-8027020">project</a> with all
inheritance-related issues.</p>
<p>See <a href="https://swcregistry.io/docs/SWC-125">SWC-125</a></p>
<hr />
<h3 id="use-interface-type-instead-of-the-address-for-type-safety">Use interface type instead of the address for type safety<a class="headerlink" href="#use-interface-type-instead-of-the-address-for-type-safety" title="Permanent link">&para;</a></h3>
<p>When a function takes a contract address as an argument, it is better to pass an interface or
contract type rather than a raw <code>address</code>. If the function is called elsewhere within the source
code, the compiler will provide additional type safety guarantees.</p>
<p>Here we see two alternatives:</p>
<div class="highlight"><pre><span></span><code><span class="kd">contract</span> <span class="n">Validator</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="n">validate</span><span class="p">(</span><span class="kt">uint</span><span class="p">)</span> <span class="k">external</span> <span class="k">returns</span><span class="p">(</span><span class="kt">bool</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="n">TypeSafeAuction</span> <span class="p">{</span>
    <span class="c1">// good</span>
    <span class="kd">function</span> <span class="n">validateBet</span><span class="p">(</span><span class="n">Validator</span> <span class="n">_validator</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">_value</span><span class="p">)</span> <span class="k">internal</span> <span class="k">returns</span><span class="p">(</span><span class="kt">bool</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">bool</span> <span class="n">valid</span> <span class="o">=</span> <span class="n">_validator</span><span class="p">.</span><span class="n">validate</span><span class="p">(</span><span class="n">_value</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">valid</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="n">TypeUnsafeAuction</span> <span class="p">{</span>
    <span class="c1">// bad</span>
    <span class="kd">function</span> <span class="n">validateBet</span><span class="p">(</span><span class="kt">address</span> <span class="n">_addr</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">_value</span><span class="p">)</span> <span class="k">internal</span> <span class="k">returns</span><span class="p">(</span><span class="kt">bool</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">Validator</span> <span class="n">validator</span> <span class="o">=</span> <span class="n">Validator</span><span class="p">(</span><span class="n">_addr</span><span class="p">);</span>
        <span class="kt">bool</span> <span class="n">valid</span> <span class="o">=</span> <span class="n">validator</span><span class="p">.</span><span class="n">validate</span><span class="p">(</span><span class="n">_value</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">valid</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>The benefits of using the <code>TypeSafeAuction</code> contract above can then be seen from the following
example. If <code>validateBet()</code> is called with an <code>address</code> argument, or a contract type other than
<code>Validator</code>, the compiler will throw this error:</p>
<div class="highlight"><pre><span></span><code><span class="kd">contract</span> <span class="n">NonValidator</span><span class="p">{}</span>

<span class="kd">contract</span> <span class="n">Auction</span> <span class="k">is</span> <span class="n">TypeSafeAuction</span> <span class="p">{</span>
    <span class="n">NonValidator</span> <span class="n">nonValidator</span><span class="p">;</span>

    <span class="kd">function</span> <span class="n">bet</span><span class="p">(</span><span class="kt">uint</span> <span class="n">_value</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">bool</span> <span class="n">valid</span> <span class="o">=</span> <span class="n">validateBet</span><span class="p">(</span><span class="n">nonValidator</span><span class="p">,</span> <span class="n">_value</span><span class="p">);</span> <span class="c1">// TypeError: Invalid type for argument in function call.</span>
                                                        <span class="c1">// Invalid implicit conversion from contract NonValidator</span>
                                                        <span class="c1">// to contract Validator requested.</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<hr />
<h3 id="avoid-using-extcodesize-to-check-for-externally-owned-accounts">Avoid using <code>extcodesize</code> to check for Externally Owned Accounts<a class="headerlink" href="#avoid-using-extcodesize-to-check-for-externally-owned-accounts" title="Permanent link">&para;</a></h3>
<p>The following modifier (or a similar check) is often used to verify whether a call was made from an
externally owned account (EOA) or a contract account:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// bad</span>
<span class="kd">modifier</span> <span class="n">isNotContract</span><span class="p">(</span><span class="kt">address</span> <span class="n">_a</span><span class="p">)</span> <span class="p">{</span>
  <span class="kt">uint</span> <span class="n">size</span><span class="p">;</span>
  <span class="k">assembly</span> <span class="p">{</span>
    <span class="n">size</span> <span class="o">:=</span> <span class="nf">extcodesize</span><span class="p">(</span><span class="n">_a</span><span class="p">)</span>
  <span class="p">}</span>
    <span class="n">require</span><span class="p">(</span><span class="n">size</span> <span class="err">==</span> <span class="mi">0</span><span class="p">)</span><span class="err">;</span>
     <span class="n">_</span><span class="err">;</span>
<span class="p">}</span>
</code></pre></div>
<p>The idea is straightforward: if an address contains code, it's not an EOA but a contract account.
However, <strong>a contract does not have source code available during construction</strong>. This means that
while the constructor is running, it can make calls to other contracts, but <code>extcodesize</code> for its
address returns zero. Below is a minimal example that shows how this check can be circumvented:</p>
<div class="highlight"><pre><span></span><code><span class="kd">contract</span> <span class="n">OnlyForEOA</span> <span class="p">{</span>    
    <span class="kt">uint</span> <span class="k">public</span> <span class="n">flag</span><span class="p">;</span>

    <span class="c1">// bad</span>
    <span class="kd">modifier</span> <span class="n">isNotContract</span><span class="p">(</span><span class="kt">address</span> <span class="n">_a</span><span class="p">){</span>
        <span class="kt">uint</span> <span class="n">len</span><span class="p">;</span>
        <span class="k">assembly</span> <span class="p">{</span> <span class="n">len</span> <span class="o">:=</span> <span class="nf">extcodesize</span><span class="p">(</span><span class="n">_a</span><span class="p">)</span> <span class="p">}</span>
        <span class="n">require</span><span class="p">(</span><span class="n">len</span> <span class="err">==</span> <span class="mi">0</span><span class="p">)</span><span class="err">;</span>
        <span class="n">_</span><span class="err">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="n">setFlag</span><span class="p">(</span><span class="kt">uint</span> <span class="n">i</span><span class="p">)</span> <span class="k">public</span> <span class="n">isNotContract</span><span class="p">(</span><span class="nb">msg.sender</span><span class="p">){</span>
        <span class="n">flag</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="n">FakeEOA</span> <span class="p">{</span>
    <span class="kd">constructor</span><span class="p">(</span><span class="kt">address</span> <span class="n">_a</span><span class="p">)</span> <span class="k">public</span> <span class="p">{</span>
        <span class="n">OnlyForEOA</span> <span class="n">c</span> <span class="o">=</span> <span class="n">OnlyForEOA</span><span class="p">(</span><span class="n">_a</span><span class="p">);</span>
        <span class="n">c</span><span class="p">.</span><span class="n">setFlag</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Because contract addresses can be pre-computed, this check could also fail if it checks an address
which is empty at block <code>n</code>, but which has a contract deployed to it at some block greater than
<code>n</code>.</p>
<div class="admonition warning">
<p class="admonition-title">This issue is nuanced.</p>
<p>If your goal is to prevent other contracts from being able to call your contract, the <code>extcodesize</code> check is probably sufficient. An alternative approach is to check the value of <code>(tx.origin == msg.sender)</code>, though this also <a href="recommendations/#avoid-using-txorigin">has drawbacks</a>.</p>
<p>There may be other situations in which the <code>extcodesize</code> check serves your purpose. Describing all of them here is out of scope. Understand the underlying behaviors of the EVM and use your Judgement.</p>
</div>
<h2 id="deprecatedhistorical-recommendations">Deprecated/historical recommendations<a class="headerlink" href="#deprecatedhistorical-recommendations" title="Permanent link">&para;</a></h2>
<p>These are recommendations which are no longer relevant due to changes in the protocol or
improvements to solidity. They are recorded here for posterity and awareness.</p>
<h3 id="beware-division-by-zero-solidity-04">Beware division by zero (Solidity \&lt; 0.4)<a class="headerlink" href="#beware-division-by-zero-solidity-04" title="Permanent link">&para;</a></h3>
<p>Prior to version 0.4, Solidity <a href="https://github.com/ethereum/solidity/issues/670">returns zero</a> and
does not <code>throw</code> an exception when a number is divided by zero. Ensure you're running at least
version 0.4.</p>
<h3 id="differentiate-functions-and-events-solidity-0421">Differentiate functions and events (Solidity \&lt; 0.4.21)<a class="headerlink" href="#differentiate-functions-and-events-solidity-0421" title="Permanent link">&para;</a></h3>
<p>Favor capitalization and a prefix in front of events (we suggest <em>Log</em>), to prevent the risk of
confusion between functions and events. For functions, always start with a lowercase letter, except
for the constructor.</p>
<div class="highlight"><pre><span></span><code><span class="c1">// bad</span>
<span class="kd">event</span> <span class="n">Transfer</span><span class="p">()</span> <span class="p">{}</span>
<span class="kd">function</span> <span class="nf">transfer</span><span class="p">()</span> <span class="p">{}</span>

<span class="c1">// good</span>
<span class="kd">event</span> <span class="n">LogTransfer</span><span class="p">()</span> <span class="p">{}</span>
<span class="kd">function</span> <span class="nf">transfer</span><span class="p">()</span> <span class="k">external</span> <span class="p">{}</span>
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In <a href="https://github.com/ethereum/solidity/blob/develop/Changelog.md#0421-2018-03-07">v0.4.21</a> Solidity
introduced the <code>emit</code> keyword to indicate an event <code>emit EventName();</code>. As of 0.5.0, it is
required.</p>
</div>

              
            </article>
          </div>
        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" data-md-state="hidden">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13,20H11V8L5.5,13.5L4.08,12.08L12,4.16L19.92,12.08L18.5,13.5L13,8V20Z" /></svg>
            Back to top
          </a>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../general_philosophy/" class="md-footer__link md-footer__link--prev" aria-label="Previous: General Philosophy" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              General Philosophy
            </div>
          </div>
        </a>
      
      
        
        <a href="../known_attacks/" class="md-footer__link md-footer__link--next" aria-label="Next: Known Attacks" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Known Attacks
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4,11V13H16L10.5,18.5L11.92,19.92L19.84,12L11.92,4.08L10.5,5.5L16,11H4Z" /></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
      
      
    
    <a href="https://consensys.net/diligence/blog/" target="_blank" rel="noopener" title="consensys.net" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M466.5 83.7l-192-80a48.15 48.15 0 0 0-36.9 0l-192 80C27.7 91.1 16 108.6 16 128c0 198.5 114.5 335.7 221.5 380.3 11.8 4.9 25.1 4.9 36.9 0C360.1 472.6 496 349.3 496 128c0-19.4-11.7-36.9-29.5-44.3zM256.1 446.3l-.1-381 175.9 73.3c-3.3 151.4-82.1 261.1-175.8 307.7z"/></svg>
    </a>
  
    
    
      
      
    
    <a href="https://github.com/ConsenSys/" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
    
    
      
      
    
    <a href="https://twitter.com/ConsenSysAudits" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
    </a>
  
    
    
      
      
    
    <a href="https://medium.com/consensys-diligence" target="_blank" rel="noopener" title="medium.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M0 32v448h448V32H0zm372.2 106.1l-24 23c-2.1 1.6-3.1 4.2-2.7 6.7v169.3c-.4 2.6.6 5.2 2.7 6.7l23.5 23v5.1h-118V367l24.3-23.6c2.4-2.4 2.4-3.1 2.4-6.7V199.8l-67.6 171.6h-9.1L125 199.8v115c-.7 4.8 1 9.7 4.4 13.2l31.6 38.3v5.1H71.2v-5.1l31.6-38.3c3.4-3.5 4.9-8.4 4.1-13.2v-133c.4-3.7-1-7.3-3.8-9.8L75 138.1V133h87.3l67.4 148L289 133.1h83.2v5z"/></svg>
    </a>
  
    
    
      
      
    
    <a href="https://www.youtube.com/channel/UCkoGLA5DUdXO4Qfo_9RDjIA/playlists" target="_blank" rel="noopener" title="www.youtube.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305zm-317.51 213.508V175.185l142.739 81.205-142.739 81.201z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.instant", "header.autohide", "navigation.sections", "navigation.top"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../assets/javascripts/workers/search.22074ed6.min.js"}</script>
    
    
      <script src="../assets/javascripts/bundle.960e086b.min.js"></script>
      
    
  </body>
</html>