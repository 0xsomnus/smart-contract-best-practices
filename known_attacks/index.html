
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Ethereum Smart Contract Security Best Practices">
      
      
        <meta name="author" content="ConsenSys Diligence">
      
      
        <link rel="canonical" href="https://consensys.github.io/smart-contract-best-practices/known_attacks/">
      
      <link rel="icon" href="../assets/images/CDili_black.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-8.1.8">
    
    
      
        <title>Known Attacks - Ethereum Smart Contract Best Practices</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.6e60f8b8.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.e6a45f82.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  


  <script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-64552723-12","auto"),ga("set","anonymizeIp",!0),ga("send","pageview"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){var e;this.value&&(e=document.location.pathname,ga("send","pageview",e+"?q="+this.value))}),"undefined"!=typeof location$&&location$.subscribe(function(e){ga("send","pageview",e.pathname)})})</script>
  <script async src="https://www.google-analytics.com/analytics.js"></script>


    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="deep-purple">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#reentrancy" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Ethereum Smart Contract Best Practices" class="md-header__button md-logo" aria-label="Ethereum Smart Contract Best Practices" data-md-component="logo">
      
  <img src="../assets/images/CDili.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3,6H21V8H3V6M3,11H21V13H3V11M3,16H21V18H3V16Z" /></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Ethereum Smart Contract Best Practices
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Known Attacks
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="deep-purple"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12,2A7,7 0 0,0 5,9C5,11.38 6.19,13.47 8,14.74V17A1,1 0 0,0 9,18H15A1,1 0 0,0 16,17V14.74C17.81,13.47 19,11.38 19,9A7,7 0 0,0 12,2M9,21A1,1 0 0,0 10,22H14A1,1 0 0,0 15,21V20H9V21Z" /></svg>
            </label>
          
        
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="cyan"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12,2A7,7 0 0,1 19,9C19,11.38 17.81,13.47 16,14.74V17A1,1 0 0,1 15,18H9A1,1 0 0,1 8,17V14.74C6.19,13.47 5,11.38 5,9A7,7 0 0,1 12,2M9,21V20H15V21A1,1 0 0,1 14,22H10A1,1 0 0,1 9,21M12,4A5,5 0 0,0 7,9C7,11.05 8.23,12.81 10,13.58V16H14V13.58C15.77,12.81 17,11.05 17,9A5,5 0 0,0 12,4Z" /></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z" /></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z" /></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z" /></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/ConsenSys/smart-contract-best-practices/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    Github
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Ethereum Smart Contract Best Practices" class="md-nav__button md-logo" aria-label="Ethereum Smart Contract Best Practices" data-md-component="logo">
      
  <img src="../assets/images/CDili.png" alt="logo">

    </a>
    Ethereum Smart Contract Best Practices
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/ConsenSys/smart-contract-best-practices/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    Github
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../general_philosophy/" class="md-nav__link">
        General Philosophy
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../recommendations/" class="md-nav__link">
        Secure Development Recommendations
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Known Attacks
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Known Attacks
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#reentrancy" class="md-nav__link">
    Reentrancy
  </a>
  
    <nav class="md-nav" aria-label="Reentrancy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#reentrancy-on-a-single-function" class="md-nav__link">
    Reentrancy on a Single Function
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cross-function-reentrancy" class="md-nav__link">
    Cross-function Reentrancy
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pitfalls-in-reentrancy-solutions" class="md-nav__link">
    Pitfalls in Reentrancy Solutions
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#oracle-manipulation" class="md-nav__link">
    Oracle Manipulation
  </a>
  
    <nav class="md-nav" aria-label="Oracle Manipulation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#oracle-manipulation-solutions" class="md-nav__link">
    Oracle Manipulation Solutions
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#front-running" class="md-nav__link">
    Front-Running
  </a>
  
    <nav class="md-nav" aria-label="Front-Running">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#taxonomy" class="md-nav__link">
    Taxonomy
  </a>
  
    <nav class="md-nav" aria-label="Taxonomy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#displacement" class="md-nav__link">
    Displacement
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#insertion" class="md-nav__link">
    Insertion
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#suppression" class="md-nav__link">
    Suppression
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mitigations" class="md-nav__link">
    Mitigations
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#timestamp-dependence" class="md-nav__link">
    Timestamp Dependence
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#integer-overflow-and-underflow" class="md-nav__link">
    Integer Overflow and Underflow
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dos-with-unexpected-revert" class="md-nav__link">
    DoS with (Unexpected) revert
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dos-with-block-gas-limit" class="md-nav__link">
    DoS with Block Gas Limit
  </a>
  
    <nav class="md-nav" aria-label="DoS with Block Gas Limit">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#gas-limit-dos-on-a-contract-via-unbounded-operations" class="md-nav__link">
    Gas Limit DoS on a Contract via Unbounded Operations
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gas-limit-dos-on-the-network-via-block-stuffing" class="md-nav__link">
    Gas Limit DoS on the Network via Block Stuffing
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#insufficient-gas-griefing" class="md-nav__link">
    Insufficient gas griefing
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#forcibly-sending-ether-to-a-contract" class="md-nav__link">
    Forcibly Sending Ether to a Contract
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deprecatedhistorical-attacks" class="md-nav__link">
    Deprecated/historical attacks
  </a>
  
    <nav class="md-nav" aria-label="Deprecated/historical attacks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#call-depth-attack-deprecated" class="md-nav__link">
    Call Depth Attack (deprecated)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#constantinople-reentrancy-attack" class="md-nav__link">
    Constantinople Reentrancy Attack
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#other-vulnerabilities" class="md-nav__link">
    Other Vulnerabilities
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../software_engineering/" class="md-nav__link">
        Software Engineering Techniques
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../tokens/" class="md-nav__link">
        Token specific recommendations
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../documentation_procedures/" class="md-nav__link">
        Documentation and Procedures
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../security_tools/" class="md-nav__link">
        Security Tools
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../bug_bounty_list/" class="md-nav__link">
        Bug Bounty Programs
      </a>
    </li>
  

    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_10" type="checkbox" id="__nav_10" >
      
      
      
      
        <label class="md-nav__link" for="__nav_10">
          About
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="About" data-md-level="1">
        <label class="md-nav__title" for="__nav_10">
          <span class="md-nav__icon md-icon"></span>
          About
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../about/reviewers/" class="md-nav__link">
        Reviewers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../about/license/" class="md-nav__link">
        License
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../about/contributing/" class="md-nav__link">
        Contributing
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#reentrancy" class="md-nav__link">
    Reentrancy
  </a>
  
    <nav class="md-nav" aria-label="Reentrancy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#reentrancy-on-a-single-function" class="md-nav__link">
    Reentrancy on a Single Function
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cross-function-reentrancy" class="md-nav__link">
    Cross-function Reentrancy
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pitfalls-in-reentrancy-solutions" class="md-nav__link">
    Pitfalls in Reentrancy Solutions
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#oracle-manipulation" class="md-nav__link">
    Oracle Manipulation
  </a>
  
    <nav class="md-nav" aria-label="Oracle Manipulation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#oracle-manipulation-solutions" class="md-nav__link">
    Oracle Manipulation Solutions
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#front-running" class="md-nav__link">
    Front-Running
  </a>
  
    <nav class="md-nav" aria-label="Front-Running">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#taxonomy" class="md-nav__link">
    Taxonomy
  </a>
  
    <nav class="md-nav" aria-label="Taxonomy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#displacement" class="md-nav__link">
    Displacement
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#insertion" class="md-nav__link">
    Insertion
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#suppression" class="md-nav__link">
    Suppression
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mitigations" class="md-nav__link">
    Mitigations
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#timestamp-dependence" class="md-nav__link">
    Timestamp Dependence
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#integer-overflow-and-underflow" class="md-nav__link">
    Integer Overflow and Underflow
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dos-with-unexpected-revert" class="md-nav__link">
    DoS with (Unexpected) revert
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dos-with-block-gas-limit" class="md-nav__link">
    DoS with Block Gas Limit
  </a>
  
    <nav class="md-nav" aria-label="DoS with Block Gas Limit">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#gas-limit-dos-on-a-contract-via-unbounded-operations" class="md-nav__link">
    Gas Limit DoS on a Contract via Unbounded Operations
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gas-limit-dos-on-the-network-via-block-stuffing" class="md-nav__link">
    Gas Limit DoS on the Network via Block Stuffing
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#insufficient-gas-griefing" class="md-nav__link">
    Insufficient gas griefing
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#forcibly-sending-ether-to-a-contract" class="md-nav__link">
    Forcibly Sending Ether to a Contract
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deprecatedhistorical-attacks" class="md-nav__link">
    Deprecated/historical attacks
  </a>
  
    <nav class="md-nav" aria-label="Deprecated/historical attacks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#call-depth-attack-deprecated" class="md-nav__link">
    Call Depth Attack (deprecated)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#constantinople-reentrancy-attack" class="md-nav__link">
    Constantinople Reentrancy Attack
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#other-vulnerabilities" class="md-nav__link">
    Other Vulnerabilities
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
<a href="https://github.com/ConsenSys/smart-contract-best-practices/edit/master/docs/known_attacks.md" title="Edit this page" class="md-content__button md-icon">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71,7.04C21.1,6.65 21.1,6 20.71,5.63L18.37,3.29C18,2.9 17.35,2.9 16.96,3.29L15.12,5.12L18.87,8.87M3,17.25V21H6.75L17.81,9.93L14.06,6.18L3,17.25Z" /></svg>
</a>


  <h1>Known Attacks</h1>

<p>The following is a list of known attacks which you should be aware of, and defend against when
writing smart contracts.</p>
<h2 id="reentrancy">Reentrancy<a class="headerlink" href="#reentrancy" title="Permanent link">&para;</a></h2>
<p>One of the major dangers of <a href="./recommendations#external-calls">calling external contracts</a> is that
they can take over the control flow, and make changes to your data that the calling function wasn't
expecting. This class of bugs can take many forms, and both of the major bugs that led to the DAO's
collapse were bugs of this sort.</p>
<h3 id="reentrancy-on-a-single-function">Reentrancy on a Single Function<a class="headerlink" href="#reentrancy-on-a-single-function" title="Permanent link">&para;</a></h3>
<p>The first version of this bug to be noticed involved functions that could be called repeatedly,
before the first invocation of the function was finished. This may cause the different invocations
of the function to interact in destructive ways.</p>
<div class="highlight"><pre><span></span><code><span class="c1">// INSECURE</span>
<span class="kd">mapping</span> <span class="p">(</span><span class="kt">address</span> <span class="o">=&gt;</span> <span class="kt">uint</span><span class="p">)</span> <span class="k">private</span> <span class="n">userBalances</span><span class="p">;</span>

<span class="kd">function</span> <span class="n">withdrawBalance</span><span class="p">()</span> <span class="k">public</span> <span class="p">{</span>
    <span class="kt">uint</span> <span class="n">amountToWithdraw</span> <span class="o">=</span> <span class="n">userBalances</span><span class="p">[</span><span class="nb">msg.sender</span><span class="p">];</span>
    <span class="p">(</span><span class="kt">bool</span> <span class="n">success</span><span class="p">,</span> <span class="p">)</span> <span class="o">=</span> <span class="nb">msg.sender</span><span class="p">.</span><span class="nf">call</span><span class="p">.</span><span class="n">value</span><span class="p">(</span><span class="n">amountToWithdraw</span><span class="p">)(</span><span class="s">&quot;&quot;</span><span class="p">);</span> <span class="c1">// At this point, the caller&#39;s code is executed, and can call withdrawBalance again</span>
    <span class="nf">require</span><span class="p">(</span><span class="n">success</span><span class="p">);</span>
    <span class="n">userBalances</span><span class="p">[</span><span class="nb">msg.sender</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>Since the user's balance is not set to 0 until the very end of the function, the second (and later)
invocations will still succeed and will withdraw the balance over and over again.</p>
<div class="admonition factoid">
<p class="admonition-title">Factoid</p>
<p>A DAO is a Decentralized Autonomous Organization. Its goal is to codify the rules and
decision-making apparatus of an organization, eliminating the need for documents and people in
governing, creating a structure with decentralized control.</p>
</div>
<div class="highlight"><pre><span></span><code>On June 17th 2016, [The DAO](https://www.coindesk.com/understanding-dao-hack-journalists) was hacked and 3.6 million Ether ($50 Million) were stolen using the first reentrancy attack.

Ethereum Foundation issued a critical update to rollback the hack. This resulted in Ethereum being forked into Ethereum Classic and Ethereum.
</code></pre></div>
<p>In the example given, the best way to prevent this attack is to make sure you don't call an
external function until you've done all the internal work you need to do:</p>
<div class="highlight"><pre><span></span><code><span class="kd">mapping</span> <span class="p">(</span><span class="kt">address</span> <span class="o">=&gt;</span> <span class="kt">uint</span><span class="p">)</span> <span class="k">private</span> <span class="n">userBalances</span><span class="p">;</span>

<span class="kd">function</span> <span class="n">withdrawBalance</span><span class="p">()</span> <span class="k">public</span> <span class="p">{</span>
    <span class="kt">uint</span> <span class="n">amountToWithdraw</span> <span class="o">=</span> <span class="n">userBalances</span><span class="p">[</span><span class="nb">msg.sender</span><span class="p">];</span>
    <span class="n">userBalances</span><span class="p">[</span><span class="nb">msg.sender</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">(</span><span class="kt">bool</span> <span class="n">success</span><span class="p">,</span> <span class="p">)</span> <span class="o">=</span> <span class="nb">msg.sender</span><span class="p">.</span><span class="nf">call</span><span class="p">.</span><span class="n">value</span><span class="p">(</span><span class="n">amountToWithdraw</span><span class="p">)(</span><span class="s">&quot;&quot;</span><span class="p">);</span> <span class="c1">// The user&#39;s balance is already 0, so future invocations won&#39;t withdraw anything</span>
    <span class="nf">require</span><span class="p">(</span><span class="n">success</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p>Note that if you had another function which called <code>withdrawBalance()</code>, it would be potentially
subject to the same attack, so you must treat any function which calls an untrusted contract as
itself untrusted. See below for further discussion of potential solutions.</p>
<h3 id="cross-function-reentrancy">Cross-function Reentrancy<a class="headerlink" href="#cross-function-reentrancy" title="Permanent link">&para;</a></h3>
<p>An attacker may also be able to do a similar attack using two different functions that share the
same state.</p>
<div class="highlight"><pre><span></span><code><span class="c1">// INSECURE</span>
<span class="kd">mapping</span> <span class="p">(</span><span class="kt">address</span> <span class="o">=&gt;</span> <span class="kt">uint</span><span class="p">)</span> <span class="k">private</span> <span class="n">userBalances</span><span class="p">;</span>

<span class="kd">function</span> <span class="nf">transfer</span><span class="p">(</span><span class="kt">address</span> <span class="n">to</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">amount</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">userBalances</span><span class="p">[</span><span class="nb">msg.sender</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">amount</span><span class="p">)</span> <span class="p">{</span>
       <span class="n">userBalances</span><span class="p">[</span><span class="n">to</span><span class="p">]</span> <span class="o">+=</span> <span class="n">amount</span><span class="p">;</span>
       <span class="n">userBalances</span><span class="p">[</span><span class="nb">msg.sender</span><span class="p">]</span> <span class="o">-=</span> <span class="n">amount</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="n">withdrawBalance</span><span class="p">()</span> <span class="k">public</span> <span class="p">{</span>
    <span class="kt">uint</span> <span class="n">amountToWithdraw</span> <span class="o">=</span> <span class="n">userBalances</span><span class="p">[</span><span class="nb">msg.sender</span><span class="p">];</span>
    <span class="p">(</span><span class="kt">bool</span> <span class="n">success</span><span class="p">,</span> <span class="p">)</span> <span class="o">=</span> <span class="nb">msg.sender</span><span class="p">.</span><span class="nf">call</span><span class="p">.</span><span class="n">value</span><span class="p">(</span><span class="n">amountToWithdraw</span><span class="p">)(</span><span class="s">&quot;&quot;</span><span class="p">);</span> <span class="c1">// At this point, the caller&#39;s code is executed, and can call transfer()</span>
    <span class="nf">require</span><span class="p">(</span><span class="n">success</span><span class="p">);</span>
    <span class="n">userBalances</span><span class="p">[</span><span class="nb">msg.sender</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>In this case, the attacker calls <code>transfer()</code> when their code is executed on the external call in
<code>withdrawBalance</code>. Since their balance has not yet been set to 0, they are able to transfer the
tokens even though they already received the withdrawal. This vulnerability was also used in the
DAO attack.</p>
<p>The same solutions will work, with the same caveats. Also note that in this example, both functions
were part of the same contract. However, the same bug can occur across multiple contracts, if those
contracts share state.</p>
<h3 id="pitfalls-in-reentrancy-solutions">Pitfalls in Reentrancy Solutions<a class="headerlink" href="#pitfalls-in-reentrancy-solutions" title="Permanent link">&para;</a></h3>
<p>Since reentrancy can occur across multiple functions, and even multiple contracts, any solution
aimed at preventing reentrancy with a single function will not be sufficient.</p>
<p>Instead, <strong>we have recommended finishing all internal work (ie. state changes) first, and only then
calling the external function</strong>. This rule, if followed carefully, will allow you to avoid
vulnerabilities due to reentrancy. However, you need to not only avoid calling external functions
too soon, but also avoid calling functions which call external functions. For example, the
following is insecure:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// INSECURE</span>
<span class="kd">mapping</span> <span class="p">(</span><span class="kt">address</span> <span class="o">=&gt;</span> <span class="kt">uint</span><span class="p">)</span> <span class="k">private</span> <span class="n">userBalances</span><span class="p">;</span>
<span class="kd">mapping</span> <span class="p">(</span><span class="kt">address</span> <span class="o">=&gt;</span> <span class="kt">bool</span><span class="p">)</span> <span class="k">private</span> <span class="n">claimedBonus</span><span class="p">;</span>
<span class="kd">mapping</span> <span class="p">(</span><span class="kt">address</span> <span class="o">=&gt;</span> <span class="kt">uint</span><span class="p">)</span> <span class="k">private</span> <span class="n">rewardsForA</span><span class="p">;</span>

<span class="kd">function</span> <span class="n">withdrawReward</span><span class="p">(</span><span class="kt">address</span> <span class="n">recipient</span><span class="p">)</span> <span class="k">public</span> <span class="p">{</span>
    <span class="kt">uint</span> <span class="n">amountToWithdraw</span> <span class="o">=</span> <span class="n">rewardsForA</span><span class="p">[</span><span class="n">recipient</span><span class="p">];</span>
    <span class="n">rewardsForA</span><span class="p">[</span><span class="n">recipient</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">(</span><span class="kt">bool</span> <span class="n">success</span><span class="p">,</span> <span class="p">)</span> <span class="o">=</span> <span class="n">recipient</span><span class="p">.</span><span class="nf">call</span><span class="p">.</span><span class="n">value</span><span class="p">(</span><span class="n">amountToWithdraw</span><span class="p">)(</span><span class="s">&quot;&quot;</span><span class="p">);</span>
    <span class="nf">require</span><span class="p">(</span><span class="n">success</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="n">getFirstWithdrawalBonus</span><span class="p">(</span><span class="kt">address</span> <span class="n">recipient</span><span class="p">)</span> <span class="k">public</span> <span class="p">{</span>
    <span class="nf">require</span><span class="p">(</span><span class="o">!</span><span class="n">claimedBonus</span><span class="p">[</span><span class="n">recipient</span><span class="p">]);</span> <span class="c1">// Each recipient should only be able to claim the bonus once</span>

    <span class="n">rewardsForA</span><span class="p">[</span><span class="n">recipient</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">100</span><span class="p">;</span>
    <span class="n">withdrawReward</span><span class="p">(</span><span class="n">recipient</span><span class="p">);</span> <span class="c1">// At this point, the caller will be able to execute getFirstWithdrawalBonus again.</span>
    <span class="n">claimedBonus</span><span class="p">[</span><span class="n">recipient</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>Even though <code>getFirstWithdrawalBonus()</code> doesn't directly call an external contract, the call in
<code>withdrawReward()</code> is enough to make it vulnerable to a reentrancy. You therefore need to treat
<code>withdrawReward()</code> as if it were also untrusted.</p>
<div class="highlight"><pre><span></span><code><span class="kd">mapping</span> <span class="p">(</span><span class="kt">address</span> <span class="o">=&gt;</span> <span class="kt">uint</span><span class="p">)</span> <span class="k">private</span> <span class="n">userBalances</span><span class="p">;</span>
<span class="kd">mapping</span> <span class="p">(</span><span class="kt">address</span> <span class="o">=&gt;</span> <span class="kt">bool</span><span class="p">)</span> <span class="k">private</span> <span class="n">claimedBonus</span><span class="p">;</span>
<span class="kd">mapping</span> <span class="p">(</span><span class="kt">address</span> <span class="o">=&gt;</span> <span class="kt">uint</span><span class="p">)</span> <span class="k">private</span> <span class="n">rewardsForA</span><span class="p">;</span>

<span class="kd">function</span> <span class="n">untrustedWithdrawReward</span><span class="p">(</span><span class="kt">address</span> <span class="n">recipient</span><span class="p">)</span> <span class="k">public</span> <span class="p">{</span>
    <span class="kt">uint</span> <span class="n">amountToWithdraw</span> <span class="o">=</span> <span class="n">rewardsForA</span><span class="p">[</span><span class="n">recipient</span><span class="p">];</span>
    <span class="n">rewardsForA</span><span class="p">[</span><span class="n">recipient</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">(</span><span class="kt">bool</span> <span class="n">success</span><span class="p">,</span> <span class="p">)</span> <span class="o">=</span> <span class="n">recipient</span><span class="p">.</span><span class="nf">call</span><span class="p">.</span><span class="n">value</span><span class="p">(</span><span class="n">amountToWithdraw</span><span class="p">)(</span><span class="s">&quot;&quot;</span><span class="p">);</span>
    <span class="nf">require</span><span class="p">(</span><span class="n">success</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="n">untrustedGetFirstWithdrawalBonus</span><span class="p">(</span><span class="kt">address</span> <span class="n">recipient</span><span class="p">)</span> <span class="k">public</span> <span class="p">{</span>
    <span class="nf">require</span><span class="p">(</span><span class="o">!</span><span class="n">claimedBonus</span><span class="p">[</span><span class="n">recipient</span><span class="p">]);</span> <span class="c1">// Each recipient should only be able to claim the bonus once</span>

    <span class="n">claimedBonus</span><span class="p">[</span><span class="n">recipient</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="n">rewardsForA</span><span class="p">[</span><span class="n">recipient</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">100</span><span class="p">;</span>
    <span class="n">untrustedWithdrawReward</span><span class="p">(</span><span class="n">recipient</span><span class="p">);</span> <span class="c1">// claimedBonus has been set to true, so reentry is impossible</span>
<span class="p">}</span>
</code></pre></div>
<p>In addition to the fix making reentry impossible,
<a href="./recommendations#mark-untrusted-contracts">untrusted functions have been marked</a>. This same
pattern repeats at every level: since <code>untrustedGetFirstWithdrawalBonus()</code> calls
<code>untrustedWithdrawReward()</code>, which calls an external contract, you must also treat
<code>untrustedGetFirstWithdrawalBonus()</code> as insecure.</p>
<p>Another solution often suggested is a <a href="https://en.wikipedia.org/wiki/Mutual_exclusion">mutex</a>. This
allows you to "lock" some state so it can only be changed by the owner of the lock. A simple
example might look like this:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// Note: This is a rudimentary example, and mutexes are particularly useful where there is substantial logic and/or shared state</span>
<span class="kd">mapping</span> <span class="p">(</span><span class="kt">address</span> <span class="o">=&gt;</span> <span class="kt">uint</span><span class="p">)</span> <span class="k">private</span> <span class="n">balances</span><span class="p">;</span>
<span class="kt">bool</span> <span class="k">private</span> <span class="n">lockBalances</span><span class="p">;</span>

<span class="kd">function</span> <span class="n">deposit</span><span class="p">()</span> <span class="k">payable</span> <span class="k">public</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span><span class="p">)</span> <span class="p">{</span>
    <span class="nf">require</span><span class="p">(</span><span class="o">!</span><span class="n">lockBalances</span><span class="p">);</span>
    <span class="n">lockBalances</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="n">balances</span><span class="p">[</span><span class="nb">msg.sender</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">msg.value</span><span class="p">;</span>
    <span class="n">lockBalances</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="n">withdraw</span><span class="p">(</span><span class="kt">uint</span> <span class="n">amount</span><span class="p">)</span> <span class="k">payable</span> <span class="k">public</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span><span class="p">)</span> <span class="p">{</span>
    <span class="nf">require</span><span class="p">(</span><span class="o">!</span><span class="n">lockBalances</span> <span class="o">&amp;&amp;</span> <span class="n">amount</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">balances</span><span class="p">[</span><span class="nb">msg.sender</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">amount</span><span class="p">);</span>
    <span class="n">lockBalances</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

    <span class="p">(</span><span class="kt">bool</span> <span class="n">success</span><span class="p">,</span> <span class="p">)</span> <span class="o">=</span> <span class="nb">msg.sender</span><span class="p">.</span><span class="nf">call</span><span class="p">(</span><span class="n">amount</span><span class="p">)(</span><span class="s">&quot;&quot;</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">success</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// Normally insecure, but the mutex saves it</span>
      <span class="n">balances</span><span class="p">[</span><span class="nb">msg.sender</span><span class="p">]</span> <span class="o">-=</span> <span class="n">amount</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">lockBalances</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>If the user tries to call <code>withdraw()</code> again before the first call finishes, the lock will prevent
it from having any effect. This can be an effective pattern, but it gets tricky when you have
multiple contracts that need to cooperate. The following is insecure:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// INSECURE</span>
<span class="kd">contract</span> <span class="n">StateHolder</span> <span class="p">{</span>
    <span class="kt">uint</span> <span class="k">private</span> <span class="n">n</span><span class="p">;</span>
    <span class="kt">address</span> <span class="k">private</span> <span class="n">lockHolder</span><span class="p">;</span>

    <span class="kd">function</span> <span class="n">getLock</span><span class="p">()</span> <span class="p">{</span>
        <span class="nf">require</span><span class="p">(</span><span class="n">lockHolder</span> <span class="o">==</span> <span class="kt">address</span><span class="p">(</span><span class="mi">0</span><span class="p">));</span>
        <span class="n">lockHolder</span> <span class="o">=</span> <span class="nb">msg.sender</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="n">releaseLock</span><span class="p">()</span> <span class="p">{</span>
        <span class="nf">require</span><span class="p">(</span><span class="nb">msg.sender</span> <span class="o">==</span> <span class="n">lockHolder</span><span class="p">);</span>
        <span class="n">lockHolder</span> <span class="o">=</span> <span class="kt">address</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="n">set</span><span class="p">(</span><span class="kt">uint</span> <span class="n">newState</span><span class="p">)</span> <span class="p">{</span>
        <span class="nf">require</span><span class="p">(</span><span class="nb">msg.sender</span> <span class="o">==</span> <span class="n">lockHolder</span><span class="p">);</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">newState</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>An attacker can call <code>getLock()</code>, and then never call <code>releaseLock()</code>. If they do this, then the
contract will be locked forever, and no further changes will be able to be made. If you use mutexes
to protect against reentrancy, you will need to carefully ensure that there are no ways for a lock
to be claimed and never released. (There are other potential dangers when programming with mutexes,
such as deadlocks and livelocks. You should consult the large amount of literature already written
on mutexes, if you decide to go this route.)</p>
<p>See <a href="https://swcregistry.io/docs/SWC-107">SWC-107</a></p>
<hr />
<p>Above were examples of reentrancy involving the attacker executing malicious code <em>within a single
transaction</em>. The following are a different type of attack inherent to Blockchains: the fact that
<em>the order of transactions themselves</em> (e.g. within a block) is easily subject to manipulation.</p>
<h2 id="oracle-manipulation">Oracle Manipulation<a class="headerlink" href="#oracle-manipulation" title="Permanent link">&para;</a></h2>
<p>Protocols that rely on external data as inputs (from what's known as an
<a href="https://medium.com/better-programming/what-is-a-blockchain-oracle-f5ccab8dbd72?source=friends_link&amp;sk=d921a38466df8a9176ed8dd767d8c77d">oracle</a>)
automatically execute even if the data is incorrect, due to the nature of smart contracts. If a
protocol relies on an oracle that is hacked, deprecated, or has malicious intent, all processes
that depend on the oracle can now operate with disastrous effects.</p>
<p>For example:</p>
<ol>
<li>Protocol gets price from single Uniswap pool</li>
<li>Malicious actor drains one side of the pool with a large transaction</li>
<li>Uniswap pool starts responding with a price more than 100x what it should be</li>
<li>Protocol operates as if that were the actual price, giving the manipulator a better price</li>
</ol>
<p>We've seen examples where this will liquidate positions, allow insane arbitrage, ruin DEX
positions, and more.</p>
<h3 id="oracle-manipulation-solutions">Oracle Manipulation Solutions<a class="headerlink" href="#oracle-manipulation-solutions" title="Permanent link">&para;</a></h3>
<p>The easiest way to solve this is to use decentralized oracles. <a href="https://chain.link/">Chainlink</a> is
the leading decentralized oracle provider, and the Chainlink network can be leveraged to bring
decentralized data on-chain.</p>
<p>Another common solution is to use a time-weighted average price feed, so that price is averaged out
over <code>X</code> time periods. Not only does this prevent oracle manipulation, but it also reduces the
chance you can be front-run, as an order executed right before yours won't have as drastic an
impact on price. One tool that gathers Uniswap price feeds every thirty minutes is
<a href="https://docs.uniquote.finance/">Keep3r</a>. If you're looking to build a custom solution,
<a href="https://github.com/Uniswap/uniswap-v2-periphery/blob/master/contracts/examples/ExampleSlidingWindowOracle.sol">Uniswap provides a sliding window example</a>.</p>
<h2 id="front-running">Front-Running<a class="headerlink" href="#front-running" title="Permanent link">&para;</a></h2>
<p>Since all transactions are visible in the mempool for a short while before being executed,
observers of the network can see and react to an action before it is included in a block. An
example of how this can be exploited is with a decentralized exchange where a buy order transaction
can be seen, and second order can be broadcast and executed before the first transaction is
included. Protecting against this is difficult, as it would come down to the specific contract
itself.</p>
<p>Front-running, coined originally for traditional financial markets, is the race to order the chaos
to the winner's benefit. In financial markets, the flow of information gave birth to intermediaries
that could simply profit by being the first to know and react to some information. These attacks
mostly had been within stock market deals and early domain registries, such as whois gateways.</p>
<div class="admonition cite">
<p class="admonition-title">front-run·ning (/ˌfrəntˈrəniNG/)</p>
<p><em>noun</em>: front-running;</p>
<ol>
<li>
<p><em>STOCK MARKET</em></p>
<blockquote>
<p>the practice by market makers of dealing on advance information provided by their brokers and investment analysts, before their clients have been given the information.
<!-- [<a href="https://www.lexico.com/en/definition/front-running">OXFORD</a>] --></p>
</blockquote>
</li>
</ol>
</div>
<h3 id="taxonomy">Taxonomy<a class="headerlink" href="#taxonomy" title="Permanent link">&para;</a></h3>
<p>By defining a <a href="https://arxiv.org/abs/1902.05164">taxonomy</a> and differentiating each group from
another, we can make it easier to discuss the problem and find solutions for each group.</p>
<p>We define the following categories of front-running attacks:</p>
<ol>
<li>Displacement</li>
<li>Insertion</li>
<li>Suppression</li>
</ol>
<h4 id="displacement">Displacement<a class="headerlink" href="#displacement" title="Permanent link">&para;</a></h4>
<p>In the first type of attack, <em>a displacement attack</em>, it is <strong>not important</strong> for Alice’s (User)
function call to run after Mallory (Adversary) runs her function. Alice’s can be orphaned or run
with no meaningful effect. Examples of displacement include:</p>
<ul>
<li>Alice trying to register a domain name and Mallory registering it first;</li>
<li>Alice trying to submit a bug to receive a bounty and Mallory stealing it and submitting it first;</li>
<li>Alice trying to submit a bid in an auction and Mallory copying it.</li>
</ul>
<p>This attack is commonly performed by increasing the <code>gasPrice</code> higher than network average, often
by a multiplier of 10 or more.</p>
<h4 id="insertion">Insertion<a class="headerlink" href="#insertion" title="Permanent link">&para;</a></h4>
<p>For this type of attack, it is <strong>important</strong> to the adversary that the original function call runs
after her transaction. In an insertion attack, after Mallory runs her function, the state of the
contract is changed and she needs Alice’s original function to run on this modified state. For
example, if Alice places a purchase order on a blockchain asset at a higher price than the best
offer, Mallory will insert two transactions: she will purchase at the best offer price and then
offer the same asset for sale at Alice’s slightly higher purchase price. If Alice’s transaction is
then run after, Mallory will profit on the price difference without having to hold the asset.</p>
<p>As with displacement attacks, this is usually done by outbidding Alice's transaction in the gas
price auction.</p>
<div class="admonition info">
<p class="admonition-title">Transaction Order Dependence</p>
<p>Transaction Order Dependence is equivalent to race
condition in smart contracts. An example, if one function sets the reward percentage, and the
withdraw function uses that percentage; then withdraw transaction can be front-run by a change
reward function call, which impacts the amount that will be withdrawn eventually.</p>
<p>See <a href="https://swcregistry.io/docs/SWC-114">SWC-114</a></p>
</div>
<!-- Based on Geth default ordering, it's easy to sandwich a transaction by sending two transactions each with 1 wei higher or lower. -->

<!-- Cite theo/daniel's talk -->

<h4 id="suppression">Suppression<a class="headerlink" href="#suppression" title="Permanent link">&para;</a></h4>
<p>In a suppression attack, a.k.a <em>Block Stuffing</em> attacks, after Mallory runs her function, she tries
to delay Alice from running her function.</p>
<p>This was the case with the first winner of the "Fomo3d" game and some other on-chain hacks. The
attacker sent multiple transactions with a high <code>gasPrice</code> and <code>gasLimit</code> to custom smart contracts
that assert (or use other means) to consume all the gas and fill up the block's <code>gasLimit</code>.</p>
<div class="admonition note">
<p class="admonition-title">Variants</p>
<p>Each of these attacks has two variants, <em>asymmetric</em> and <em>bulk</em>.</p>
<p>In some cases, Alice and Mallory are performing different operations. For example, Alice is trying to cancel an offer, and Mallory is trying to fulfill it first. We call this <em>asymmetric displacement</em>. In other cases, Mallory is trying to run a large set of functions: for example, Alice and others are trying to buy a limited set of shares offered by a firm on a blockchain. We call this <em>bulk displacement</em>.</p>
</div>
<h3 id="mitigations">Mitigations<a class="headerlink" href="#mitigations" title="Permanent link">&para;</a></h3>
<p>Front-running is a pervasive issue on public blockchains such as Ethereum.</p>
<p>The best remediation is to <strong>remove the benefit of front-running in your application</strong>, mainly by
removing the importance of transaction ordering or time. For example, in markets, it would be
better to implement batch auctions (this also protects against high-frequency trading concerns).
Another way is to use a pre-commit scheme (“I’m going to submit the details later”). A third option
is to mitigate the cost of front-running by specifying a maximum or minimum acceptable price range
on a trade, thereby limiting price slippage.</p>
<p><strong>Transaction Ordering:</strong> Go-Ethereum (Geth) nodes, order the transactions based on their
<code>gasPrice</code> and address nonce. This, however, results in a gas auction between participants in the
network to get included in the block currently being mined.</p>
<p><strong>Confidentiality:</strong> Another approach is to limit the visibility of the transactions, this can be
done using a "commit and reveal" scheme.</p>
<!-- cite and properly define commit and reveal -->

<p>A simple implementation is to store the keccak256 hash of the data in the first transaction, then
reveal the data and verify it against the hash in the second transaction. However note that the
transaction itself leaks the intention and possibly the value of the collateralization. There are
enhanced commit and reveal schemes that are more secure, however require more transactions to
function, e.g. <a href="https://libsubmarine.org/">submarine sends</a>.</p>
<hr />
<h2 id="timestamp-dependence">Timestamp Dependence<a class="headerlink" href="#timestamp-dependence" title="Permanent link">&para;</a></h2>
<p>Be aware that the timestamp of the block can be manipulated by the miner, and all direct and
indirect uses of the timestamp should be considered.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>See the <a href="./recommendations/#timestamp-dependence">Recommendations</a> section for design
considerations related to Timestamp Dependence.</p>
<p>See <a href="https://swcregistry.io/docs/SWC-116">SWC-116</a></p>
</div>
<hr />
<h2 id="integer-overflow-and-underflow">Integer Overflow and Underflow<a class="headerlink" href="#integer-overflow-and-underflow" title="Permanent link">&para;</a></h2>
<p>Consider a simple token transfer:</p>
<div class="highlight"><pre><span></span><code><span class="kd">mapping</span> <span class="p">(</span><span class="kt">address</span> <span class="o">=&gt;</span> <span class="kt">uint256</span><span class="p">)</span> <span class="k">public</span> <span class="n">balanceOf</span><span class="p">;</span>

<span class="c1">// INSECURE</span>
<span class="kd">function</span> <span class="nf">transfer</span><span class="p">(</span><span class="kt">address</span> <span class="n">_to</span><span class="p">,</span> <span class="kt">uint256</span> <span class="n">_value</span><span class="p">)</span> <span class="p">{</span>
    <span class="cm">/* Check if sender has balance */</span>
    <span class="nf">require</span><span class="p">(</span><span class="n">balanceOf</span><span class="p">[</span><span class="nb">msg.sender</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">_value</span><span class="p">);</span>
    <span class="cm">/* Add and subtract new balances */</span>
    <span class="n">balanceOf</span><span class="p">[</span><span class="nb">msg.sender</span><span class="p">]</span> <span class="o">-=</span> <span class="n">_value</span><span class="p">;</span>
    <span class="n">balanceOf</span><span class="p">[</span><span class="n">_to</span><span class="p">]</span> <span class="o">+=</span> <span class="n">_value</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// SECURE</span>
<span class="kd">function</span> <span class="nf">transfer</span><span class="p">(</span><span class="kt">address</span> <span class="n">_to</span><span class="p">,</span> <span class="kt">uint256</span> <span class="n">_value</span><span class="p">)</span> <span class="p">{</span>
    <span class="cm">/* Check if sender has balance and for overflows */</span>
    <span class="nf">require</span><span class="p">(</span><span class="n">balanceOf</span><span class="p">[</span><span class="nb">msg.sender</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">_value</span> <span class="o">&amp;&amp;</span> <span class="n">balanceOf</span><span class="p">[</span><span class="n">_to</span><span class="p">]</span> <span class="o">+</span> <span class="n">_value</span> <span class="o">&gt;=</span> <span class="n">balanceOf</span><span class="p">[</span><span class="n">_to</span><span class="p">]);</span>

    <span class="cm">/* Add and subtract new balances */</span>
    <span class="n">balanceOf</span><span class="p">[</span><span class="nb">msg.sender</span><span class="p">]</span> <span class="o">-=</span> <span class="n">_value</span><span class="p">;</span>
    <span class="n">balanceOf</span><span class="p">[</span><span class="n">_to</span><span class="p">]</span> <span class="o">+=</span> <span class="n">_value</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>If a balance reaches the <em>maximum uint value (2^256)</em> it will circle back to zero which checks for
the condition. This may or may not be relevant, depending on the implementation. Think about
whether or not the <code>uint</code> value has an opportunity to approach such a large number. Think about how
the <code>uint</code> variable changes state, and who has authority to make such changes. If any user can call
functions which update the <code>uint</code> value, it's more vulnerable to attack. If only an admin has
access to change the variable's state, you might be safe. If a user can increment by only 1 at a
time, you are probably also safe because there is no feasible way to reach this limit.</p>
<p>The same is true for underflow. If a uint is made to be less than zero, it will cause an underflow
and get set to its maximum value.</p>
<p>Be careful with the smaller data-types like uint8, uint16, uint24...etc: they can even more easily
hit their maximum value.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Be aware there are around <a href="https://github.com/ethereum/solidity/issues/796#issuecomment-253578925">20 cases for overflow and underflow</a>.</p>
<p>One simple solution to mitigate the common mistakes for overflow and underflow is to use
<code>SafeMath.sol</code>
<a href="https://github.com/OpenZeppelin/openzeppelin-solidity/blob/master/contracts/math/SafeMath.sol">library</a>
for arithmetic functions. Solidity automatically reverts on integer overflow and underflow, as of
version 0.8.0.</p>
<p>See <a href="https://swcregistry.io/docs/SWC-101">SWC-101</a></p>
</div>
<hr />
<p><a name="dos-with-unexpected-revert"></a></p>
<h2 id="dos-with-unexpected-revert">DoS with (Unexpected) revert<a class="headerlink" href="#dos-with-unexpected-revert" title="Permanent link">&para;</a></h2>
<p>Consider a simple auction contract:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// INSECURE</span>
<span class="kd">contract</span> <span class="n">Auction</span> <span class="p">{</span>
    <span class="kt">address</span> <span class="n">currentLeader</span><span class="p">;</span>
    <span class="kt">uint</span> <span class="n">highestBid</span><span class="p">;</span>

    <span class="kd">function</span> <span class="n">bid</span><span class="p">()</span> <span class="k">payable</span> <span class="p">{</span>
        <span class="nf">require</span><span class="p">(</span><span class="nb">msg.value</span> <span class="o">&gt;</span> <span class="n">highestBid</span><span class="p">);</span>

        <span class="nf">require</span><span class="p">(</span><span class="n">currentLeader</span><span class="p">.</span><span class="nf">send</span><span class="p">(</span><span class="n">highestBid</span><span class="p">));</span> <span class="c1">// Refund the old leader, if it fails then revert</span>

        <span class="n">currentLeader</span> <span class="o">=</span> <span class="nb">msg.sender</span><span class="p">;</span>
        <span class="n">highestBid</span> <span class="o">=</span> <span class="nb">msg.value</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>If attacker bids using a smart contract which has a fallback function that reverts any payment, the
attacker can win any auction. When it tries to refund the old leader, it reverts if the refund
fails. This means that a malicious bidder can become the leader while making sure that any refunds
to their address will <em>always</em> fail. In this way, they can prevent anyone else from calling the
<code>bid()</code> function, and stay the leader forever. A recommendation is to set up a
<a href="./recommendations#favor-pull-over-push-for-external-calls">pull payment system</a> instead, as
described earlier.</p>
<p>Another example is when a contract may iterate through an array to pay users (e.g., supporters in a
crowdfunding contract). It's common to want to make sure that each payment succeeds. If not, one
should revert. The issue is that if one call fails, you are reverting the whole payout system,
meaning the loop will never complete. No one gets paid because one address is forcing an error.</p>
<div class="highlight"><pre><span></span><code><span class="kt">address</span><span class="p">[]</span> <span class="k">private</span> <span class="n">refundAddresses</span><span class="p">;</span>
<span class="kd">mapping</span> <span class="p">(</span><span class="kt">address</span> <span class="o">=&gt;</span> <span class="kt">uint</span><span class="p">)</span> <span class="k">public</span> <span class="n">refunds</span><span class="p">;</span>

<span class="c1">// bad</span>
<span class="kd">function</span> <span class="n">refundAll</span><span class="p">()</span> <span class="k">public</span> <span class="p">{</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">uint</span> <span class="n">x</span><span class="p">;</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">refundAddresses</span><span class="p">.</span><span class="n">length</span><span class="p">;</span> <span class="n">x</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// arbitrary length iteration based on how many addresses participated</span>
        <span class="nf">require</span><span class="p">(</span><span class="n">refundAddresses</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="nf">send</span><span class="p">(</span><span class="n">refunds</span><span class="p">[</span><span class="n">refundAddresses</span><span class="p">[</span><span class="n">x</span><span class="p">]]))</span> <span class="c1">// doubly bad, now a single failure on send will hold up all funds</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Again, the recommended solution is to
<a href="./recommendations#favor-pull-over-push-for-external-calls">favor pull over push payments</a>.</p>
<p>See <a href="https://swcregistry.io/docs/SWC-113">SWC-113</a></p>
<hr />
<h2 id="dos-with-block-gas-limit">DoS with Block Gas Limit<a class="headerlink" href="#dos-with-block-gas-limit" title="Permanent link">&para;</a></h2>
<p>Each block has an upper bound on the amount of gas that can be spent, and thus the amount
computation that can be done. This is the Block Gas Limit. If the gas spent exceeds this limit, the
transaction will fail. This leads to a couple of possible Denial of Service vectors:</p>
<h3 id="gas-limit-dos-on-a-contract-via-unbounded-operations">Gas Limit DoS on a Contract via Unbounded Operations<a class="headerlink" href="#gas-limit-dos-on-a-contract-via-unbounded-operations" title="Permanent link">&para;</a></h3>
<p>You may have noticed another problem with the previous example: by paying out to everyone at once,
you risk running into the block gas limit.</p>
<p>This can lead to problems even in the absence of an intentional attack. However, it's especially
bad if an attacker can manipulate the amount of gas needed. In the case of the previous example,
the attacker could add a bunch of addresses, each of which needs to get a very small refund. The
gas cost of refunding each of the attacker's addresses could, therefore, end up being more than the
gas limit, blocking the refund transaction from happening at all.</p>
<p>This is another reason to
<a href="./recommendations#favor-pull-over-push-for-external-calls">favor pull over push payments</a>.</p>
<p>If you absolutely must loop over an array of unknown size, then you should plan for it to
potentially take multiple blocks, and therefore require multiple transactions. You will need to
keep track of how far you've gone, and be able to resume from that point, as in the following
example:</p>
<div class="highlight"><pre><span></span><code><span class="kd">struct</span> <span class="n">Payee</span> <span class="p">{</span>
    <span class="kt">address</span> <span class="n">addr</span><span class="p">;</span>
    <span class="kt">uint256</span> <span class="n">value</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">Payee</span><span class="p">[]</span> <span class="n">payees</span><span class="p">;</span>
<span class="kt">uint256</span> <span class="n">nextPayeeIndex</span><span class="p">;</span>

<span class="kd">function</span> <span class="n">payOut</span><span class="p">()</span> <span class="p">{</span>
    <span class="kt">uint256</span> <span class="n">i</span> <span class="o">=</span> <span class="n">nextPayeeIndex</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="n">payees</span><span class="p">.</span><span class="n">length</span> <span class="o">&amp;&amp;</span> <span class="nb">msg.gas</span> <span class="o">&gt;</span> <span class="mi">200000</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">payees</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">addr</span><span class="p">.</span><span class="nf">send</span><span class="p">(</span><span class="n">payees</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">value</span><span class="p">);</span>
      <span class="n">i</span><span class="o">++</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">nextPayeeIndex</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>You will need to make sure that nothing bad will happen if other transactions are processed while
waiting for the next iteration of the <code>payOut()</code> function. So only use this pattern if absolutely
necessary.</p>
<h3 id="gas-limit-dos-on-the-network-via-block-stuffing">Gas Limit DoS on the Network via Block Stuffing<a class="headerlink" href="#gas-limit-dos-on-the-network-via-block-stuffing" title="Permanent link">&para;</a></h3>
<p>Even if your contract does not contain an unbounded loop, an attacker can prevent other
transactions from being included in the blockchain for several blocks by placing computationally
intensive transactions with a high enough gas price.</p>
<p>To do this, the attacker can issue several transactions which will consume the entire gas limit,
with a high enough gas price to be included as soon as the next block is mined. No gas price can
guarantee inclusion in the block, but the higher the price is, the higher is the chance.</p>
<p>If the attack succeeds, no other transactions will be included in the block. Sometimes, an
attacker's goal is to block transactions to a specific contract prior to specific time.</p>
<p>This attack <a href="https://solmaz.io/2018/10/18/anatomy-block-stuffing/">was conducted</a> on Fomo3D, a
gambling app. The app was designed to reward the last address that purchased a "key". Each key
purchase extended the timer, and the game ended once the timer went to 0. The attacker bought a key
and then stuffed 13 blocks in a row until the timer was triggered and the payout was released.
Transactions sent by attacker took 7.9 million gas on each block, so the gas limit allowed a few
small "send" transactions (which take 21,000 gas each), but disallowed any calls to the <code>buyKey()</code>
function (which costs 300,000+ gas).</p>
<p>A Block Stuffing attack can be used on any contract requiring an action within a certain time
period. However, as with any attack, it is only profitable when the expected reward exceeds its
cost. The cost of this attack is directly proportional to the number of blocks which need to be
stuffed. If a large payout can be obtained by preventing actions from other participants, your
contract will likely be targeted by such an attack.</p>
<p>See <a href="https://swcregistry.io/docs/SWC-128">SWC-128</a></p>
<hr />
<h2 id="insufficient-gas-griefing">Insufficient gas griefing<a class="headerlink" href="#insufficient-gas-griefing" title="Permanent link">&para;</a></h2>
<p>This attack may be possible on a contract which accepts generic data and uses it to make a call
another contract (a 'sub-call') via the low level <code>address.call()</code> function, as is often the case
with multisignature and transaction relayer contracts.</p>
<p>If the call fails, the contract has two options:</p>
<ol>
<li>revert the whole transaction</li>
<li>continue execution.</li>
</ol>
<p>Take the following example of a simplified <code>Relayer</code> contract which continues execution regardless
of the outcome of the subcall:</p>
<div class="highlight"><pre><span></span><code><span class="kd">contract</span> <span class="n">Relayer</span> <span class="p">{</span>
    <span class="kd">mapping</span> <span class="p">(</span><span class="kt">bytes</span> <span class="o">=&gt;</span> <span class="kt">bool</span><span class="p">)</span> <span class="n">executed</span><span class="p">;</span>

    <span class="kd">function</span> <span class="n">relay</span><span class="p">(</span><span class="kt">bytes</span> <span class="n">_data</span><span class="p">)</span> <span class="k">public</span> <span class="p">{</span>
        <span class="c1">// replay protection; do not call the same transaction twice</span>
        <span class="nf">require</span><span class="p">(</span><span class="n">executed</span><span class="p">[</span><span class="n">_data</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;Duplicate call&quot;</span><span class="p">);</span>
        <span class="n">executed</span><span class="p">[</span><span class="n">_data</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="n">innerContract</span><span class="p">.</span><span class="nf">call</span><span class="p">(</span><span class="kt">bytes4</span><span class="p">(</span><span class="nf">keccak256</span><span class="p">(</span><span class="s">&quot;execute(bytes)&quot;</span><span class="p">)),</span> <span class="n">_data</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>This contract allows transaction relaying. Someone who wants to make a transaction but can't
execute it by himself (e.g. due to the lack of ether to pay for gas) can sign data that he wants to
pass and transfer the data with his signature over any medium. A third party "forwarder" can then
submit this transaction to the network on behalf of the user.</p>
<p>If given just the right amount of gas, the <code>Relayer</code> would complete execution recording the
<code>_data</code>argument in the <code>executed</code> mapping, but the subcall would fail because it received
insufficient gas to complete execution.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When a contract makes a sub-call to another contract, the EVM limits the gas forwarded to
<a href="https://github.com/ethereum/EIPs/blob/master/EIPS/eip-150.md">to 63/64 of the remaining gas</a>,</p>
</div>
<p>An attacker can use this to censor transactions, causing them to fail by sending them with a low
amount of gas. This attack is a form of "<a href="https://en.wikipedia.org/wiki/Griefer">griefing</a>": It
doesn't directly benefit the attacker, but causes grief for the victim. A dedicated attacker,
willing to consistently spend a small amount of gas could theoretically censor all transactions
this way, if they were the first to submit them to <code>Relayer</code>.</p>
<p>One way to address this is to implement logic requiring forwarders to provide enough gas to finish
the subcall. If the miner tried to conduct the attack in this scenario, the <code>require</code> statement
would fail and the inner call would revert. A user can specify a minimum gasLimit along with the
other data (in this example, typically the <code>_gasLimit</code> value would be verified by a signature, but
that is omitted for simplicity in this case).</p>
<div class="highlight"><pre><span></span><code><span class="c1">// contract called by Relayer</span>
<span class="kd">contract</span> <span class="n">Executor</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="n">execute</span><span class="p">(</span><span class="kt">bytes</span> <span class="n">_data</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">_gasLimit</span><span class="p">)</span> <span class="p">{</span>
        <span class="nf">require</span><span class="p">(</span><span class="nf">gasleft</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="n">_gasLimit</span><span class="p">);</span>
        <span class="p">...</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Another solution is to permit only trusted accounts to relay the transaction.</p>
<hr />
<h2 id="forcibly-sending-ether-to-a-contract">Forcibly Sending Ether to a Contract<a class="headerlink" href="#forcibly-sending-ether-to-a-contract" title="Permanent link">&para;</a></h2>
<p>It is possible to forcibly send Ether to a contract without triggering its fallback function. This
is an important consideration when placing important logic in the fallback function or making
calculations based on a contract's balance. Take the following example:</p>
<div class="highlight"><pre><span></span><code><span class="kd">contract</span> <span class="n">Vulnerable</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="p">()</span> <span class="k">payable</span> <span class="p">{</span>
        <span class="nf">revert</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="n">somethingBad</span><span class="p">()</span> <span class="p">{</span>
        <span class="nf">require</span><span class="p">(</span><span class="nb">this</span><span class="p">.</span><span class="nb">balance</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">);</span>
        <span class="c1">// Do something bad</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Contract logic seems to disallow payments to the contract and therefore disallow "something bad"
from happening. However, a few methods exist for forcibly sending ether to the contract and
therefore making its balance greater than zero.</p>
<p>The <code>selfdestruct</code> contract method allows a user to specify a beneficiary to send any excess ether.
<code>selfdestruct</code>
<a href="https://solidity.readthedocs.io/en/develop/security-considerations.html#sending-and-receiving-ether">does not trigger a contract's fallback function</a>.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>It is also possible to <a href="https://github.com/Arachnid/uscc/tree/master/submissions-2017/ricmoo">precompute</a> a contract's address and send Ether to that address before deploying the contract.</p>
<p>See <a href="https://swcregistry.io/docs/SWC-132">SWC-132</a></p>
</div>
<hr />
<h2 id="deprecatedhistorical-attacks">Deprecated/historical attacks<a class="headerlink" href="#deprecatedhistorical-attacks" title="Permanent link">&para;</a></h2>
<p>These are attacks which are no longer possible due to changes in the protocol or improvements to
solidity. They are recorded here for posterity and awareness.</p>
<h3 id="call-depth-attack-deprecated">Call Depth Attack (deprecated)<a class="headerlink" href="#call-depth-attack-deprecated" title="Permanent link">&para;</a></h3>
<p>As of the <a href="https://github.com/ethereum/EIPs/issues/150">EIP 150</a> hardfork, call depth attacks are
no longer
relevant<sup><a href='http://ethereum.stackexchange.com/questions/9398/how-does-eip-150-change-the-call-depth-attack'>*</a></sup>
(all gas would be consumed well before reaching the 1024 call depth limit).</p>
<h3 id="constantinople-reentrancy-attack">Constantinople Reentrancy Attack<a class="headerlink" href="#constantinople-reentrancy-attack" title="Permanent link">&para;</a></h3>
<p>On January 16<sup>th</sup>, 2019, Constantinople protocol upgrade was delayed due to a security vulnerability
enabled by <a href="https://eips.ethereum.org/EIPS/eip-1283">EIP 1283</a>. <em>EIP 1283: Net gas metering for
SSTORE without dirty maps</em> proposes changes to reduce excessive gas costs on dirty storage writes.</p>
<p>This change led to possibility of a new reentrancy vector making previously known secure withdrawal
patterns (<code>.send()</code> and <code>.transfer()</code>) unsafe in specific
situations<sup><a href='https://medium.com/chainsecurity/constantinople-enables-new-reentrancy-attack-ace4088297d9'>*</a></sup>,
where the attacker could hijack the control flow and use the remaining gas enabled by EIP 1283,
leading to vulnerabilities due to reentrancy.</p>
<h2 id="other-vulnerabilities">Other Vulnerabilities<a class="headerlink" href="#other-vulnerabilities" title="Permanent link">&para;</a></h2>
<p>The
<a href="https://smartcontractsecurity.github.io/SWC-registry/">Smart Contract Weakness Classification Registry</a>
offers a complete and up-to-date catalogue of known smart contract vulnerabilities and
anti-patterns along with real-world examples. Browsing the registry is a good way of keeping
up-to-date with the latest attacks.</p>

              
            </article>
          </div>
        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" data-md-state="hidden">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13,20H11V8L5.5,13.5L4.08,12.08L12,4.16L19.92,12.08L18.5,13.5L13,8V20Z" /></svg>
            Back to top
          </a>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../recommendations/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Secure Development Recommendations" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Secure Development Recommendations
            </div>
          </div>
        </a>
      
      
        
        <a href="../software_engineering/" class="md-footer__link md-footer__link--next" aria-label="Next: Software Engineering Techniques" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Software Engineering Techniques
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4,11V13H16L10.5,18.5L11.92,19.92L19.84,12L11.92,4.08L10.5,5.5L16,11H4Z" /></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
      
      
    
    <a href="https://consensys.net/diligence/blog/" target="_blank" rel="noopener" title="consensys.net" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M466.5 83.7l-192-80a48.15 48.15 0 0 0-36.9 0l-192 80C27.7 91.1 16 108.6 16 128c0 198.5 114.5 335.7 221.5 380.3 11.8 4.9 25.1 4.9 36.9 0C360.1 472.6 496 349.3 496 128c0-19.4-11.7-36.9-29.5-44.3zM256.1 446.3l-.1-381 175.9 73.3c-3.3 151.4-82.1 261.1-175.8 307.7z"/></svg>
    </a>
  
    
    
      
      
    
    <a href="https://github.com/ConsenSys/" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
    
    
      
      
    
    <a href="https://twitter.com/ConsenSysAudits" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
    </a>
  
    
    
      
      
    
    <a href="https://medium.com/consensys-diligence" target="_blank" rel="noopener" title="medium.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M0 32v448h448V32H0zm372.2 106.1l-24 23c-2.1 1.6-3.1 4.2-2.7 6.7v169.3c-.4 2.6.6 5.2 2.7 6.7l23.5 23v5.1h-118V367l24.3-23.6c2.4-2.4 2.4-3.1 2.4-6.7V199.8l-67.6 171.6h-9.1L125 199.8v115c-.7 4.8 1 9.7 4.4 13.2l31.6 38.3v5.1H71.2v-5.1l31.6-38.3c3.4-3.5 4.9-8.4 4.1-13.2v-133c.4-3.7-1-7.3-3.8-9.8L75 138.1V133h87.3l67.4 148L289 133.1h83.2v5z"/></svg>
    </a>
  
    
    
      
      
    
    <a href="https://www.youtube.com/channel/UCkoGLA5DUdXO4Qfo_9RDjIA/playlists" target="_blank" rel="noopener" title="www.youtube.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305zm-317.51 213.508V175.185l142.739 81.205-142.739 81.201z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.instant", "header.autohide", "navigation.sections", "navigation.top"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../assets/javascripts/workers/search.22074ed6.min.js"}</script>
    
    
      <script src="../assets/javascripts/bundle.960e086b.min.js"></script>
      
    
  </body>
</html>